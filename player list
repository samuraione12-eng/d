-- Roblox Rivals Player Information Script (Client-Sided) - ENHANCED UI
-- VERSION: 3.0 OPTIMIZED - Maximum Performance (Jan 24, 2026)
-- Optimizations: Reduced local variables, streamlined UI creation, improved performance
print("========================================")
print("INFO.TXT VERSION 3.0 OPTIMIZED LOADED")
print("‚ú® Performance optimizations active")
print("========================================")

--// Anti-Double-Execution Check
if _G.RivalsPlayerInfoLoaded then
    -- Create custom styled notification
    local Players = game:GetService("Players")
    local TweenService = game:GetService("TweenService")
    local Player = Players.LocalPlayer
    local PlayerGui = Player:WaitForChild("PlayerGui")
    
    local NotifGui = Instance.new("ScreenGui")
    NotifGui.Name = "AlreadyExecutedNotif"
    NotifGui.ResetOnSpawn = false
    NotifGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    NotifGui.Parent = PlayerGui
    
    local NotifFrame = Instance.new("Frame")
    NotifFrame.Name = "NotifFrame"
    NotifFrame.Size = UDim2.new(0, 400, 0, 100)
    NotifFrame.Position = UDim2.new(0.5, -200, -0.2, 0)
    NotifFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    NotifFrame.BorderSizePixel = 0
    NotifFrame.Parent = NotifGui
    
    local NotifCorner = Instance.new("UICorner")
    NotifCorner.CornerRadius = UDim.new(0, 15)
    NotifCorner.Parent = NotifFrame
    
    local NotifStroke = Instance.new("UIStroke")
    NotifStroke.Color = Color3.fromRGB(255, 100, 100)
    NotifStroke.Thickness = 3
    NotifStroke.Parent = NotifFrame
    
    local NotifGradient = Instance.new("UIGradient")
    NotifGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 25, 35)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 20, 30))
    }
    NotifGradient.Rotation = 135
    NotifGradient.Parent = NotifFrame
    
    -- Icon container
    local IconContainer = Instance.new("Frame")
    IconContainer.Name = "IconContainer"
    IconContainer.Size = UDim2.new(0, 50, 0, 50)
    IconContainer.Position = UDim2.new(0, 10, 0.5, -25)
    IconContainer.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    IconContainer.BackgroundTransparency = 0.9
    IconContainer.BorderSizePixel = 0
    IconContainer.Parent = NotifFrame
    
    local IconCorner = Instance.new("UICorner")
    IconCorner.CornerRadius = UDim.new(0, 10)
    IconCorner.Parent = IconContainer
    
    local IconLabel = Instance.new("TextLabel")
    IconLabel.Size = UDim2.new(1, 0, 1, 0)
    IconLabel.BackgroundTransparency = 1
    IconLabel.Text = "‚ö†Ô∏è"
    IconLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    IconLabel.Font = Enum.Font.GothamBold
    IconLabel.TextSize = 28
    IconLabel.Parent = IconContainer
    
    -- Content container
    local ContentContainer = Instance.new("Frame")
    ContentContainer.Size = UDim2.new(1, -80, 1, -20)
    ContentContainer.Position = UDim2.new(0, 70, 0, 10)
    ContentContainer.BackgroundTransparency = 1
    ContentContainer.Parent = NotifFrame
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Size = UDim2.new(1, 0, 0, 30)
    TitleLabel.Position = UDim2.new(0, 0, 0, 10)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = "Already Executed"
    TitleLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 18
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.TextYAlignment = Enum.TextYAlignment.Top
    TitleLabel.Parent = ContentContainer
    
    local MessageLabel = Instance.new("TextLabel")
    MessageLabel.Name = "MessageLabel"
    MessageLabel.Size = UDim2.new(1, 0, 0, 40)
    MessageLabel.Position = UDim2.new(0, 0, 0, 40)
    MessageLabel.BackgroundTransparency = 1
    MessageLabel.Text = "Script is already running!"
    MessageLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
    MessageLabel.Font = Enum.Font.Gotham
    MessageLabel.TextSize = 15
    MessageLabel.TextXAlignment = Enum.TextXAlignment.Left
    MessageLabel.TextYAlignment = Enum.TextYAlignment.Top
    MessageLabel.TextWrapped = true
    MessageLabel.Parent = ContentContainer
    
    -- Slide in animation
    TweenService:Create(NotifFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(0.5, -200, 0.05, 0)
    }):Play()
    
    -- Icon bounce animation
    task.wait(0.3)
    TweenService:Create(IconLabel, TweenInfo.new(0.3, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out), {
        TextSize = 28
    }):Play()
    
    -- Pulse the stroke color
    local pulseTween = TweenService:Create(NotifStroke, TweenInfo.new(0.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
        Color = Color3.fromRGB(255, 150, 150)
    })
    pulseTween:Play()
    
    -- Wait and slide out
    task.wait(3)
    pulseTween:Cancel()
    TweenService:Create(NotifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
        Position = UDim2.new(0.5, -200, -0.2, 0)
    }):Play()
    
    task.wait(0.5)
    NotifGui:Destroy()
    return
end
_G.RivalsPlayerInfoLoaded = true
-- Displays: Avatar, Level, Win Streak, and Rank with Rank Image for ALL players except yourself
-- Location: Top Left of Screen

--// Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

--// Variables
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

--// Check if user has premium key (from keysystem)
local IsPremium = (_G.EIGHT_BIT_KEY_TYPE and _G.EIGHT_BIT_KEY_TYPE ~= "Free") or false

--// Declare premium-only UI elements at top level (will be nil for free users)
local ModDetectorToggle, ModDetectorToggleStroke
local WebhookInput
local ModAlarmToggle, ModAlarmToggleStroke
local FriendScanToggle, FriendScanToggleStroke
local AlarmVolumeLabel, AlarmVolumeSliderFill
local VolumeLabel, SliderFill, SliderButton
local MusicToggle, MusicStroke
local PlayRandomButton, PlayRandomStroke, PlayOrderButton, PlayOrderStroke
local BackgroundMusic

--// Settings (defined early so functions can use it)
local Settings = {
    ToggleKey = Enum.KeyCode.RightShift,
    SoundFXEnabled = true,
    MusicEnabled = false,
    CurrentMusic = 1,
    PlaybackMode = "order", -- "order" or "random"
    MusicVolume = 100, -- Volume from 1 to 1000 (default 100 = 1.0 Roblox volume)
    MouseUnlockEnabled = true, -- Enable/disable custom mouse cursor when UI is open
    ModDetectorEnabled = true, -- Enable/disable mod detector
    ModWebhookURL = "", -- Discord webhook URL for mod notifications
    ModAlarmEnabled = true, -- Enable/disable mod alarm sound
    ModAlarmVolume = 6, -- Mod alarm volume from 1 to 500
    FriendScanEnabled = true -- Enable/disable friend list scanning for mods/known players
}

--// Mod Detector Configuration
local config = {
    enabled = true,
    
    -- Game Owners / Administrators (High Priority)
    ownerList = {
        [20349956]=true,  -- nosniy - Game Owner
        [15941965]=true,  -- Co-Owner/Admin
        -- Add more owners below:
        -- [123456789]=true,  -- Username - Role
    },
    
    -- Moderators / Staff (Medium Priority)
    modWatchList = {
        [9774834404]=true,[3342805365]=true,[180434077]=true,[478848349]=true,
        [7171389384]=true,[164100188]=true,[163180763]=true,[549095619]=true,
        [224264658]=true,[99268362]=true,[131577796]=true,[3161872154]=true,
        [1602256048]=true,[1302259915]=true,[219021541]=true,[39560492]=true,
        [475975042]=true,[877654864]=true,[754154414]=true,[31598456]=true,
        [1399517213]=true,[8034104]=true,
        [158374605]=true,[113947873]=true,[133321104]=true,[3010656315]=true,
        -- Add more mods below:
        -- [123456789]=true,  -- Username - Moderator
    },
    
    -- Known Players / Pro Players / Content Creators (Low Priority)
    knownWatchList = {
        [9132728378]=true,[7171389384]=true,[3410760577]=true,[2722548028]=true,
        [3038813476]=true,[1676897355]=true,[1212564846]=true,[1170157879]=true,
        [817372683]=true,[976048069]=true,[20576250]=true,[324386852]=true,
        [1699080206]=true,[4761042954]=true,[716661842]=true,[1952198604]=true,
        [3960908652]=true,[5041464410]=true,[719253194]=true,[72777686]=true,
        [93396927]=true,[1570344799]=true,[2715139893]=true,[2592044281]=true,
        [7509170326]=true,[3168035361]=true,[299656551]=true,[7114434816]=true,
        [2398965451]=true,[8876776576]=true,[8854090897]=true,[2589526320]=true,
        [904064295]=true,[1347365278]=true,[1197113640]=true,[711164374]=true,
        [167011353]=true,[4045652628]=true,[835918816]=true,[1634295899]=true,
        [484209710]=true,[1046882754]=true,[301707243]=true,[4814045937]=true,
        [192648256]=true,[4979329484]=true,[18394211]=true,[2627770086]=true,
        [1283600369]=true,[988801608]=true,[5499975764]=true,[7519940219]=true,
        [5441022436]=true,[33916776]=true,[590056862]=true,[1596012708]=true,
        [1503659477]=true,[160222694]=true,[538421707]=true,[174371231]=true,
        [158782923]=true,[1366392507]=true,[4701284318]=true,[622420080]=true,
        [907880682]=true,[7360779969]=true,[477778892]=true,[1010680683]=true,
        [761517915]=true,[3805605247]=true,[129345706]=true,[289034063]=true,
        [570996811]=true,[508441337]=true,[423324971]=true,[4681641674]=true,
        [1796383039]=true,[68729698]=true,[10230753409]=true,
        -- Add more known players below:
        -- [123456789]=true,  -- Username - Pro Player/Content Creator/etc
    }
}

--// Cache for player information
local playerInfoCache = {}
local friendScanCache = {} -- Cache scanned friends to avoid duplicate notifications
local activeNotifications = 0 -- Track active friend scan notifications for stacking
local PlayerCards = {} -- Storage for player cards (defined early for use in functions)

--// Create ScreenGui (with protected name to avoid detection)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = math.random(100000, 999999) .. "_UI" -- Random name to avoid detection
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = false

-- Protect the GUI from game scripts if possible
if gethui then
    ScreenGui.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = PlayerGui
else
    ScreenGui.Parent = PlayerGui
end

--// Custom Mouse Cursor (GUI-based to ensure visibility) - Created early so functions can reference it
local CustomCursor = Instance.new("ImageLabel")
CustomCursor.Name = "CustomCursor"
CustomCursor.Parent = ScreenGui
CustomCursor.BackgroundTransparency = 1
CustomCursor.Size = UDim2.new(0, 51, 0, 51) -- 3x bigger for visibility
CustomCursor.Image = "rbxasset://textures/Cursors/KeyboardMouse/ArrowCursor.png"
CustomCursor.AnchorPoint = Vector2.new(0, 0) -- Anchor at top-left (arrow tip)
CustomCursor.ZIndex = 10000
CustomCursor.Visible = true

--// Sound Effects
local SoundContainer = Instance.new("Folder")
SoundContainer.Name = "Sounds"
SoundContainer.Parent = ScreenGui

-- Click Sound
local ClickSound = Instance.new("Sound")
ClickSound.Name = "ClickSound"
ClickSound.SoundId = "rbxassetid://6895079853" -- Modern UI click
ClickSound.Volume = 0.3
ClickSound.Parent = SoundContainer

-- Hover Sound
local HoverSound = Instance.new("Sound")
HoverSound.Name = "HoverSound"
HoverSound.SoundId = "rbxassetid://6895079853" -- Same as click but quieter
HoverSound.Volume = 0.15
HoverSound.Parent = SoundContainer

-- Collapse Sound
local CollapseSound = Instance.new("Sound")
CollapseSound.Name = "CollapseSound"
CollapseSound.SoundId = "rbxassetid://6895079853" -- UI whoosh
CollapseSound.Volume = 0.4
CollapseSound.PlaybackSpeed = 1.2
CollapseSound.Parent = SoundContainer

-- Expand Sound
local ExpandSound = Instance.new("Sound")
ExpandSound.Name = "ExpandSound"
ExpandSound.SoundId = "rbxassetid://6895079853" -- UI whoosh
ExpandSound.Volume = 0.4
ExpandSound.PlaybackSpeed = 0.8
ExpandSound.Parent = SoundContainer

-- Card Load Sound
local CardLoadSound = Instance.new("Sound")
CardLoadSound.Name = "CardLoadSound"
CardLoadSound.SoundId = "rbxassetid://6895079853" -- Card entrance
CardLoadSound.Volume = 0.25
CardLoadSound.PlaybackSpeed = 1.3
CardLoadSound.Parent = SoundContainer

-- Sparkle/Pop Sound
local SparkleSound = Instance.new("Sound")
SparkleSound.Name = "SparkleSound"
SparkleSound.SoundId = "rbxassetid://6895079853" -- Sparkle effect
SparkleSound.Volume = 0.2
SparkleSound.PlaybackSpeed = 2.0
SparkleSound.Parent = SoundContainer

--// Title Bar (starts with animation but immediately draggable)
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(0, 400, 0, 50)
TitleBar.Position = UDim2.new(0, 15, 0, -100)
TitleBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
TitleBar.BorderSizePixel = 0
TitleBar.Active = true
TitleBar.BackgroundTransparency = 1
TitleBar.Parent = ScreenGui

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local TitleStroke = Instance.new("UIStroke")
TitleStroke.Color = Color3.fromRGB(120, 120, 255)
TitleStroke.Thickness = 2
TitleStroke.Transparency = 0.3
TitleStroke.Parent = TitleBar

local TitleGradient = Instance.new("UIGradient")
TitleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 20, 30)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 20, 40))
}
TitleGradient.Rotation = 45
TitleGradient.Parent = TitleBar

--// Title Text
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, -140, 1, 0)
TitleLabel.Position = UDim2.new(0, 15, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "‚öîÔ∏è RIVALS INFO | By New_Jmaster"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 16
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

--// Settings Button
local SettingsButton = Instance.new("TextButton")
SettingsButton.Name = "SettingsButton"
SettingsButton.Size = UDim2.new(0, 40, 0, 40)
SettingsButton.Position = UDim2.new(1, -130, 0, 5)
SettingsButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
SettingsButton.BorderSizePixel = 0
SettingsButton.Text = "‚öôÔ∏è"
SettingsButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SettingsButton.Font = Enum.Font.GothamBold
SettingsButton.TextSize = 18
SettingsButton.AutoButtonColor = false
SettingsButton.Parent = TitleBar

local SettingsButtonCorner = Instance.new("UICorner")
SettingsButtonCorner.CornerRadius = UDim.new(0, 8)
SettingsButtonCorner.Parent = SettingsButton

local SettingsButtonStroke = Instance.new("UIStroke")
SettingsButtonStroke.Color = Color3.fromRGB(100, 100, 150)
SettingsButtonStroke.Thickness = 2
SettingsButtonStroke.Transparency = 0.5
SettingsButtonStroke.Parent = SettingsButton

--// Collapse/Expand Button
local CollapseButton = Instance.new("TextButton")
CollapseButton.Name = "CollapseButton"
CollapseButton.Size = UDim2.new(0, 40, 0, 40)
CollapseButton.Position = UDim2.new(1, -80, 0, 5)
CollapseButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
CollapseButton.BorderSizePixel = 0
CollapseButton.Text = "‚ñº"
CollapseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CollapseButton.Font = Enum.Font.GothamBold
CollapseButton.TextSize = 18
CollapseButton.AutoButtonColor = false
CollapseButton.Parent = TitleBar

local CollapseButtonCorner = Instance.new("UICorner")
CollapseButtonCorner.CornerRadius = UDim.new(0, 8)
CollapseButtonCorner.Parent = CollapseButton

local CollapseButtonStroke = Instance.new("UIStroke")
CollapseButtonStroke.Color = Color3.fromRGB(100, 100, 150)
CollapseButtonStroke.Thickness = 2
CollapseButtonStroke.Transparency = 0.5
CollapseButtonStroke.Parent = CollapseButton

--// Player Count Label
local PlayerCountLabel = Instance.new("TextLabel")
PlayerCountLabel.Name = "PlayerCountLabel"
PlayerCountLabel.Size = UDim2.new(0, 40, 1, 0)
PlayerCountLabel.Position = UDim2.new(1, -50, 0, 0)
PlayerCountLabel.BackgroundTransparency = 1
PlayerCountLabel.Text = "0"
PlayerCountLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
PlayerCountLabel.Font = Enum.Font.GothamBold
PlayerCountLabel.TextSize = 16
PlayerCountLabel.TextXAlignment = Enum.TextXAlignment.Right
PlayerCountLabel.Parent = TitleBar

--// Main Container for all player cards (starts with animation but immediately draggable)
local MainContainer = Instance.new("ScrollingFrame")
MainContainer.Name = "MainContainer"
MainContainer.Size = UDim2.new(0, 400, 0, 650)
MainContainer.Position = UDim2.new(0, 15, 0, -40)
MainContainer.BackgroundColor3 = Color3.fromRGB(12, 12, 18)
MainContainer.BorderSizePixel = 0
MainContainer.ScrollBarThickness = 8
MainContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
MainContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
MainContainer.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 120)
MainContainer.Active = true
MainContainer.BackgroundTransparency = 1
MainContainer.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainContainer

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(120, 120, 255)
MainStroke.Thickness = 2
MainStroke.Transparency = 0.3
MainStroke.Parent = MainContainer

local MainGradient = Instance.new("UIGradient")
MainGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(15, 15, 22)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 15, 25))
}
MainGradient.Rotation = 90
MainGradient.Parent = MainContainer

--// UIListLayout for player cards
local ListLayout = Instance.new("UIListLayout")
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ListLayout.Padding = UDim.new(0, 10)
ListLayout.Parent = MainContainer

local Padding = Instance.new("UIPadding")
Padding.PaddingTop = UDim.new(0, 10)
Padding.PaddingBottom = UDim.new(0, 10)
Padding.PaddingLeft = UDim.new(0, 10)
Padding.PaddingRight = UDim.new(0, 10)
Padding.Parent = MainContainer

--// Settings Menu (Draggable) - Enhanced Design
local SettingsMenu = Instance.new("Frame")
SettingsMenu.Name = "SettingsMenu"
SettingsMenu.Size = UDim2.new(0, 550, 0, 600)
SettingsMenu.Position = UDim2.new(0.5, -275, 0.5, -300)
SettingsMenu.BackgroundColor3 = Color3.fromRGB(18, 18, 25)
SettingsMenu.BorderSizePixel = 0
SettingsMenu.Visible = false
SettingsMenu.ZIndex = 100
SettingsMenu.Active = true
SettingsMenu.Parent = ScreenGui

local SettingsCorner = Instance.new("UICorner")
SettingsCorner.CornerRadius = UDim.new(0, 16)
SettingsCorner.Parent = SettingsMenu

local SettingsStroke = Instance.new("UIStroke")
SettingsStroke.Color = Color3.fromRGB(140, 140, 255)
SettingsStroke.Thickness = 3
SettingsStroke.Transparency = 0.3
SettingsStroke.Parent = SettingsMenu

local SettingsGradient = Instance.new("UIGradient")
SettingsGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 25, 38)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(18, 18, 28)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 15, 22))
}
SettingsGradient.Rotation = 135
SettingsGradient.Parent = SettingsMenu

-- Add shadow effect
local SettingsShadow = Instance.new("ImageLabel")
SettingsShadow.Name = "Shadow"
SettingsShadow.Size = UDim2.new(1, 40, 1, 40)
SettingsShadow.Position = UDim2.new(0, -20, 0, -20)
SettingsShadow.BackgroundTransparency = 1
SettingsShadow.Image = "rbxassetid://5554236805"
SettingsShadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
SettingsShadow.ImageTransparency = 0.7
SettingsShadow.ScaleType = Enum.ScaleType.Slice
SettingsShadow.SliceCenter = Rect.new(23, 23, 277, 277)
SettingsShadow.ZIndex = 99
SettingsShadow.Parent = SettingsMenu

--// Settings Title Bar (For dragging) - Enhanced
local SettingsTitleBar = Instance.new("Frame")
SettingsTitleBar.Name = "TitleBar"
SettingsTitleBar.Size = UDim2.new(1, 0, 0, 55)
SettingsTitleBar.BackgroundColor3 = Color3.fromRGB(28, 28, 45)
SettingsTitleBar.BorderSizePixel = 0
SettingsTitleBar.Parent = SettingsMenu

local TitleBarCorner = Instance.new("UICorner")
TitleBarCorner.CornerRadius = UDim.new(0, 16)
TitleBarCorner.Parent = SettingsTitleBar

local TitleBarGradient = Instance.new("UIGradient")
TitleBarGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 55)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(28, 28, 45)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(22, 22, 38))
}
TitleBarGradient.Rotation = 90
TitleBarGradient.Parent = SettingsTitleBar

local TitleBarStroke = Instance.new("UIStroke")
TitleBarStroke.Color = Color3.fromRGB(100, 100, 200)
TitleBarStroke.Thickness = 2
TitleBarStroke.Transparency = 0.6
TitleBarStroke.Parent = SettingsTitleBar

--// Settings Title with Gradient
local SettingsTitle = Instance.new("TextLabel")
SettingsTitle.Size = UDim2.new(1, -100, 1, 0)
SettingsTitle.Position = UDim2.new(0, 20, 0, 0)
SettingsTitle.BackgroundTransparency = 1
SettingsTitle.Text = "‚öôÔ∏è SETTINGS"
SettingsTitle.TextColor3 = Color3.fromRGB(200, 200, 255)
SettingsTitle.Font = Enum.Font.GothamBold
SettingsTitle.TextSize = 24
SettingsTitle.TextXAlignment = Enum.TextXAlignment.Left
SettingsTitle.Parent = SettingsTitleBar

local TitleGradient = Instance.new("UIGradient")
TitleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(150, 150, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(200, 200, 255))
}
TitleGradient.Parent = SettingsTitle

--// Close Settings Button (X)
local CloseSettingsButton = Instance.new("TextButton")
CloseSettingsButton.Size = UDim2.new(0, 40, 0, 40)
CloseSettingsButton.Position = UDim2.new(1, -45, 0, 5)
CloseSettingsButton.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
CloseSettingsButton.BorderSizePixel = 0
CloseSettingsButton.Text = "‚úï"
CloseSettingsButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseSettingsButton.Font = Enum.Font.GothamBold
CloseSettingsButton.TextSize = 20
CloseSettingsButton.Parent = SettingsTitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseSettingsButton

local CloseStroke = Instance.new("UIStroke")
CloseStroke.Color = Color3.fromRGB(255, 100, 100)
CloseStroke.Thickness = 2
CloseStroke.Transparency = 0.5
CloseStroke.Parent = CloseSettingsButton

--// Tab Buttons Container - Enhanced
local TabContainer = Instance.new("Frame")
TabContainer.Size = UDim2.new(1, -30, 0, 50)
TabContainer.Position = UDim2.new(0, 15, 0, 70)
TabContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
TabContainer.BorderSizePixel = 0
TabContainer.Parent = SettingsMenu

local TabCorner = Instance.new("UICorner")
TabCorner.CornerRadius = UDim.new(0, 12)
TabCorner.Parent = TabContainer

local TabStroke = Instance.new("UIStroke")
TabStroke.Color = Color3.fromRGB(60, 60, 100)
TabStroke.Thickness = 1.5
TabStroke.Transparency = 0.6
TabStroke.Parent = TabContainer

local TabLayout = Instance.new("UIListLayout")
TabLayout.FillDirection = Enum.FillDirection.Horizontal
TabLayout.Padding = UDim.new(0, 8)
TabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
TabLayout.Parent = TabContainer

local TabPadding = Instance.new("UIPadding")
TabPadding.PaddingLeft = UDim.new(0, 8)
TabPadding.PaddingRight = UDim.new(0, 8)
TabPadding.PaddingTop = UDim.new(0, 6)
TabPadding.PaddingBottom = UDim.new(0, 6)
TabPadding.Parent = TabContainer

--// General Tab Button - Enhanced
local GeneralTab = Instance.new("TextButton")
GeneralTab.Name = "GeneralTab"
GeneralTab.Size = UDim2.new(0.19, 0, 1, -12)
GeneralTab.BackgroundColor3 = Color3.fromRGB(70, 110, 220)
GeneralTab.BorderSizePixel = 0
GeneralTab.Text = "‚öôÔ∏è GENERAL"
GeneralTab.TextColor3 = Color3.fromRGB(255, 255, 255)
GeneralTab.Font = Enum.Font.GothamBold
GeneralTab.TextSize = 13
GeneralTab.AutoButtonColor = false
GeneralTab.Parent = TabContainer

Instance.new("UICorner", GeneralTab).CornerRadius = UDim.new(0, 10)

local GeneralTabStroke = Instance.new("UIStroke")
GeneralTabStroke.Color = Color3.fromRGB(100, 150, 255)
GeneralTabStroke.Thickness = 2
GeneralTabStroke.Transparency = 0
GeneralTabStroke.Parent = GeneralTab

--// Music Tab Button - Enhanced
local MusicTab = Instance.new("TextButton")
MusicTab.Name = "MusicTab"
MusicTab.Size = UDim2.new(0.19, 0, 1, -12)
MusicTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
MusicTab.BorderSizePixel = 0
MusicTab.Text = "üéµ MUSIC"
MusicTab.TextColor3 = Color3.fromRGB(180, 180, 200)
MusicTab.Font = Enum.Font.GothamBold
MusicTab.TextSize = 13
MusicTab.AutoButtonColor = false
MusicTab.Parent = TabContainer

Instance.new("UICorner", MusicTab).CornerRadius = UDim.new(0, 10)

local MusicTabStroke = Instance.new("UIStroke")
MusicTabStroke.Color = Color3.fromRGB(60, 60, 90)
MusicTabStroke.Thickness = 1.5
MusicTabStroke.Transparency = 0.7
MusicTabStroke.Parent = MusicTab

--// Mod Detector Tab Button - Enhanced
local ModDetectorTab = Instance.new("TextButton")
ModDetectorTab.Name = "ModDetectorTab"
ModDetectorTab.Size = UDim2.new(0.19, 0, 1, -12)
ModDetectorTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
ModDetectorTab.BorderSizePixel = 0
ModDetectorTab.Text = "üõ°Ô∏è MOD DETECTOR"
ModDetectorTab.TextColor3 = Color3.fromRGB(180, 180, 200)
ModDetectorTab.Font = Enum.Font.GothamBold
ModDetectorTab.TextSize = 11
ModDetectorTab.AutoButtonColor = false
ModDetectorTab.Parent = TabContainer

Instance.new("UICorner", ModDetectorTab).CornerRadius = UDim.new(0, 10)

local ModDetectorTabStroke = Instance.new("UIStroke")
ModDetectorTabStroke.Color = Color3.fromRGB(60, 60, 90)
ModDetectorTabStroke.Thickness = 1.5
ModDetectorTabStroke.Transparency = 0.7
ModDetectorTabStroke.Parent = ModDetectorTab

--// Known Mods Tab Button - Enhanced
local KnownModsTab = Instance.new("TextButton")
KnownModsTab.Name = "KnownModsTab"
KnownModsTab.Size = UDim2.new(0.19, 0, 1, -12)
KnownModsTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
KnownModsTab.BorderSizePixel = 0
KnownModsTab.Text = "üë• MOD & PLAYER LIST"
KnownModsTab.TextColor3 = Color3.fromRGB(180, 180, 200)
KnownModsTab.Font = Enum.Font.GothamBold
KnownModsTab.TextSize = 9
KnownModsTab.AutoButtonColor = false
KnownModsTab.Parent = TabContainer

Instance.new("UICorner", KnownModsTab).CornerRadius = UDim.new(0, 10)

local KnownModsTabStroke = Instance.new("UIStroke")
KnownModsTabStroke.Color = Color3.fromRGB(60, 60, 90)
KnownModsTabStroke.Thickness = 1.5
KnownModsTabStroke.Transparency = 0.7
KnownModsTabStroke.Parent = KnownModsTab

--// Danger Tab Button - Enhanced
local DangerTab = Instance.new("TextButton")
DangerTab.Name = "DangerTab"
DangerTab.Size = UDim2.new(0.19, 0, 1, -12)
DangerTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
DangerTab.BorderSizePixel = 0
DangerTab.Text = "üóëÔ∏è DESTROY"
DangerTab.TextColor3 = Color3.fromRGB(180, 180, 200)
DangerTab.Font = Enum.Font.GothamBold
DangerTab.TextSize = 12
DangerTab.AutoButtonColor = false
DangerTab.Parent = TabContainer

Instance.new("UICorner", DangerTab).CornerRadius = UDim.new(0, 10)

local DangerTabStroke = Instance.new("UIStroke")
DangerTabStroke.Color = Color3.fromRGB(60, 60, 90)
DangerTabStroke.Thickness = 1.5
DangerTabStroke.Transparency = 0.7
DangerTabStroke.Parent = DangerTab

--// General Settings Content - Enhanced
local GeneralContent = Instance.new("ScrollingFrame")
GeneralContent.Name = "GeneralContent"
GeneralContent.Size = UDim2.new(1, -30, 1, -140)
GeneralContent.Position = UDim2.new(0, 15, 0, 130)
GeneralContent.BackgroundTransparency = 1
GeneralContent.BorderSizePixel = 0
GeneralContent.ScrollBarThickness = 6
GeneralContent.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 180)
GeneralContent.CanvasSize = UDim2.new(0, 0, 0, 450)
GeneralContent.Visible = true
GeneralContent.Parent = SettingsMenu

local GeneralList = Instance.new("UIListLayout")
GeneralList.Padding = UDim.new(0, 15)
GeneralList.Parent = GeneralContent

local GeneralPadding = Instance.new("UIPadding")
GeneralPadding.PaddingTop = UDim.new(0, 5)
GeneralPadding.Parent = GeneralContent

--// Music Settings Content - Enhanced
local MusicContent = Instance.new("ScrollingFrame")
MusicContent.Name = "MusicContent"
MusicContent.Size = UDim2.new(1, -30, 1, -140)
MusicContent.Position = UDim2.new(0, 15, 0, 130)
MusicContent.BackgroundTransparency = 1
MusicContent.BorderSizePixel = 0
MusicContent.ScrollBarThickness = 6
MusicContent.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 180)
MusicContent.CanvasSize = UDim2.new(0, 0, 0, 0)
MusicContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
MusicContent.Visible = false
MusicContent.Parent = SettingsMenu

local MusicList = Instance.new("UIListLayout")
MusicList.Padding = UDim.new(0, 10)
MusicList.Parent = MusicContent

local MusicPadding = Instance.new("UIPadding")
MusicPadding.PaddingTop = UDim.new(0, 5)
MusicPadding.Parent = MusicContent

--// Danger Settings Content - Enhanced
local DangerContent = Instance.new("ScrollingFrame")
DangerContent.Name = "DangerContent"
DangerContent.Size = UDim2.new(1, -30, 1, -140)
DangerContent.Position = UDim2.new(0, 15, 0, 130)
DangerContent.BackgroundTransparency = 1
DangerContent.BorderSizePixel = 0
DangerContent.ScrollBarThickness = 6
DangerContent.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 180)
DangerContent.CanvasSize = UDim2.new(0, 0, 0, 250)
DangerContent.Visible = false
DangerContent.Parent = SettingsMenu

local DangerList = Instance.new("UIListLayout")
DangerList.Padding = UDim.new(0, 15)
DangerList.Parent = DangerContent

local DangerPadding = Instance.new("UIPadding")
DangerPadding.PaddingTop = UDim.new(0, 5)
DangerPadding.Parent = DangerContent

--// Mod Detector Settings Content - Enhanced
local ModDetectorContent = Instance.new("ScrollingFrame")
ModDetectorContent.Name = "ModDetectorContent"
ModDetectorContent.Size = UDim2.new(1, -30, 1, -140)
ModDetectorContent.Position = UDim2.new(0, 15, 0, 130)
ModDetectorContent.BackgroundTransparency = 1
ModDetectorContent.BorderSizePixel = 0
ModDetectorContent.ScrollBarThickness = 6
ModDetectorContent.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 180)
ModDetectorContent.CanvasSize = UDim2.new(0, 0, 0, 0)
ModDetectorContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
ModDetectorContent.Visible = false
ModDetectorContent.Parent = SettingsMenu

local ModDetectorList = Instance.new("UIListLayout")
ModDetectorList.Padding = UDim.new(0, 15)
ModDetectorList.Parent = ModDetectorContent

local ModDetectorPadding = Instance.new("UIPadding")
ModDetectorPadding.PaddingTop = UDim.new(0, 5)
ModDetectorPadding.Parent = ModDetectorContent

--// Known Mods Content - Enhanced
local KnownModsContent = Instance.new("ScrollingFrame")
KnownModsContent.Name = "KnownModsContent"
KnownModsContent.Size = UDim2.new(1, -30, 1, -140)
KnownModsContent.Position = UDim2.new(0, 15, 0, 130)
KnownModsContent.BackgroundTransparency = 1
KnownModsContent.BorderSizePixel = 0
KnownModsContent.ScrollBarThickness = 6
KnownModsContent.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 180)
KnownModsContent.CanvasSize = UDim2.new(0, 0, 0, 0)
KnownModsContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
KnownModsContent.Visible = false
KnownModsContent.Parent = SettingsMenu

local KnownModsList = Instance.new("UIListLayout")
KnownModsList.Padding = UDim.new(0, 10)
KnownModsList.Parent = KnownModsContent

local KnownModsPadding = Instance.new("UIPadding")
KnownModsPadding.PaddingTop = UDim.new(0, 5)
KnownModsPadding.Parent = KnownModsContent

--// Reference to active content
local SettingsContent = GeneralContent

--// ========== GENERAL TAB CONTENT ==========

--// ============================================================
--// üéµ MUSIC CONFIGURATION WITH SAVE/LOAD SYSTEM üéµ
--// ============================================================

local MusicTracks = {}

--// Config File Paths
local CONFIG_FOLDER = "RobloxRivalsInfo"
local MUSIC_CONFIG_FILE = CONFIG_FOLDER.."/music_config.json"
local SETTINGS_CONFIG_FILE = CONFIG_FOLDER.."/settings_config.json"

--// Function to save settings (keybind, volume, etc)
local function SaveSettings()
    local success, err = pcall(function()
        if not isfolder(CONFIG_FOLDER) then
            makefolder(CONFIG_FOLDER)
        end
        local settingsData = {
            ToggleKey = Settings.ToggleKey.Name, -- Save as string name instead of enum
            MusicEnabled = Settings.MusicEnabled,
            SoundFXEnabled = Settings.SoundFXEnabled,
            CurrentMusic = Settings.CurrentMusic,
            PlaybackMode = Settings.PlaybackMode,
            MouseUnlockEnabled = Settings.MouseUnlockEnabled,
            MusicVolume = Settings.MusicVolume,
            ModDetectorEnabled = Settings.ModDetectorEnabled,
            ModWebhookURL = Settings.ModWebhookURL,
            ModAlarmEnabled = Settings.ModAlarmEnabled,
            ModAlarmVolume = Settings.ModAlarmVolume,
            FriendScanEnabled = Settings.FriendScanEnabled
        }
        local jsonData = game:GetService("HttpService"):JSONEncode(settingsData)
        writefile(SETTINGS_CONFIG_FILE, jsonData)
        print("[DEBUG] Settings saved - MouseUnlockEnabled: " .. tostring(Settings.MouseUnlockEnabled))
    end)
    if success then
        -- Settings saved
    else
        -- Failed to save settings
    end
end

--// Function to load settings
local function LoadSettings()
    local success, result = pcall(function()
        if isfile(SETTINGS_CONFIG_FILE) then
            local jsonData = readfile(SETTINGS_CONFIG_FILE)
            return game:GetService("HttpService"):JSONDecode(jsonData)
        end
        return nil
    end)
    
    if success and result then
        -- Convert string back to KeyCode enum
        if result.ToggleKey and type(result.ToggleKey) == "string" then
            Settings.ToggleKey = Enum.KeyCode[result.ToggleKey] or Enum.KeyCode.RightShift
        else
            Settings.ToggleKey = Enum.KeyCode.RightShift
        end
        Settings.MusicEnabled = result.MusicEnabled or false
        Settings.SoundFXEnabled = result.SoundFXEnabled ~= false -- Default true if not found
        
        -- Handle MouseUnlockEnabled properly (check if it exists in saved data)
        if result.MouseUnlockEnabled ~= nil then
            Settings.MouseUnlockEnabled = result.MouseUnlockEnabled
        else
            Settings.MouseUnlockEnabled = true -- Default to true if not saved
        end
        
        Settings.MusicVolume = result.MusicVolume or 100
        Settings.PlaybackMode = result.PlaybackMode or "order"
        -- Validate CurrentMusic index
        local currentMusic = result.CurrentMusic or 1
        if type(currentMusic) == "number" and currentMusic >= 1 then
            Settings.CurrentMusic = currentMusic
        else
            Settings.CurrentMusic = 1
        end
        
        -- Load Mod Detector settings
        if result.ModDetectorEnabled ~= nil then
            Settings.ModDetectorEnabled = result.ModDetectorEnabled
        else
            Settings.ModDetectorEnabled = true -- Default to enabled
        end
        
        Settings.ModWebhookURL = result.ModWebhookURL or ""
        
        -- Load
        if result.ModAlarmEnabled ~= nil then
            Settings.ModAlarmEnabled = result.ModAlarmEnabled
        else
            Settings.ModAlarmEnabled = true -- Default to enabled
        end
        
        Settings.ModAlarmVolume = result.ModAlarmVolume or 6
        
        -- Load Friend Scan settings
        if result.FriendScanEnabled ~= nil then
            Settings.FriendScanEnabled = result.FriendScanEnabled
        else
            Settings.FriendScanEnabled = true -- Default to enabled
        end
        
        print("[DEBUG] Settings loaded - MouseUnlockEnabled: " .. tostring(Settings.MouseUnlockEnabled))
        -- Settings loaded
        return true
    else
        -- Using default settings
        return false
    end
end

--// Function to save music tracks to file
local function SaveMusicConfig()
    local success, err = pcall(function()
        if not isfolder(CONFIG_FOLDER) then
            makefolder(CONFIG_FOLDER)
        end
        local jsonData = game:GetService("HttpService"):JSONEncode(MusicTracks)
        writefile(MUSIC_CONFIG_FILE, jsonData)
    end)
    if success then
        -- Music config saved
    else
        -- Failed to save music config
    end
end

--// Function to load music tracks from file
local function LoadMusicConfig()
    local success, result = pcall(function()
        if isfile(MUSIC_CONFIG_FILE) then
            local jsonData = readfile(MUSIC_CONFIG_FILE)
            return game:GetService("HttpService"):JSONDecode(jsonData)
        end
        return nil
    end)
    
    if success and result then
        MusicTracks = result
        -- Music config loaded
        return true
    else
        -- Default tracks if no config found
        MusicTracks = {
            {Name = "Example Track", ID = "rbxassetid://1234567890", Genre = "Custom"}
        }
        -- Using default tracks
        return false
    end
end

--// Load saved configs on startup
LoadSettings()
LoadMusicConfig()

--// Section Header Helper - Enhanced
local function CreateSectionHeader(text, parent)
    local headerContainer = Instance.new("Frame")
    headerContainer.Size = UDim2.new(1, 0, 0, 35)
    headerContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
    headerContainer.BorderSizePixel = 0
    headerContainer.Parent = parent
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 8)
    headerCorner.Parent = headerContainer
    
    local headerStroke = Instance.new("UIStroke")
    headerStroke.Color = Color3.fromRGB(80, 80, 140)
    headerStroke.Thickness = 1
    headerStroke.Transparency = 0.6
    headerStroke.Parent = headerContainer
    
    local header = Instance.new("TextLabel")
    header.Size = UDim2.new(1, -20, 1, 0)
    header.Position = UDim2.new(0, 10, 0, 0)
    header.BackgroundTransparency = 1
    header.Text = text
    header.TextColor3 = Color3.fromRGB(180, 180, 255)
    header.Font = Enum.Font.GothamBold
    header.TextSize = 16
    header.TextXAlignment = Enum.TextXAlignment.Left
    header.Parent = headerContainer
    
    return headerContainer
end

--// Create section header for General tab
CreateSectionHeader("‚å®Ô∏è SET YOUR KEYBIND", GeneralContent)

--// Keybind Setting (Moved to General tab)
local KeybindButton = Instance.new("TextButton")
KeybindButton.Size = UDim2.new(1, 0, 0, 45)
KeybindButton.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
KeybindButton.BorderSizePixel = 0
KeybindButton.Text = "Right Shift (Click to change)"
KeybindButton.TextColor3 = Color3.fromRGB(255, 255, 255)
KeybindButton.Font = Enum.Font.GothamBold
KeybindButton.TextSize = 14
KeybindButton.Parent = GeneralContent

Instance.new("UICorner", KeybindButton).CornerRadius = UDim.new(0, 10)

local KeybindStroke = Instance.new("UIStroke")
KeybindStroke.Color = Color3.fromRGB(80, 80, 120)
KeybindStroke.Thickness = 2
KeybindStroke.Transparency = 0.7
KeybindStroke.Parent = KeybindButton

--// Function to get friendly key name
local function GetKeyName(keyCode)
    local keyNames = {
        [Enum.KeyCode.RightShift] = "Right Shift",
        [Enum.KeyCode.LeftShift] = "Left Shift",
        [Enum.KeyCode.RightControl] = "Right Control",
        [Enum.KeyCode.LeftControl] = "Left Control",
        [Enum.KeyCode.RightAlt] = "Right Alt",
        [Enum.KeyCode.LeftAlt] = "Left Alt",
        [Enum.KeyCode.F1] = "F1",
        [Enum.KeyCode.F2] = "F2",
        [Enum.KeyCode.F3] = "F3",
        [Enum.KeyCode.F4] = "F4",
        [Enum.KeyCode.F5] = "F5",
        [Enum.KeyCode.F6] = "F6",
        [Enum.KeyCode.F7] = "F7",
        [Enum.KeyCode.F8] = "F8",
        [Enum.KeyCode.F9] = "F9",
        [Enum.KeyCode.F10] = "F10",
        [Enum.KeyCode.F11] = "F11",
        [Enum.KeyCode.F12] = "F12",
        [Enum.KeyCode.Insert] = "Insert",
        [Enum.KeyCode.Delete] = "Delete",
        [Enum.KeyCode.Home] = "Home",
        [Enum.KeyCode.End] = "End",
        [Enum.KeyCode.PageUp] = "Page Up",
        [Enum.KeyCode.PageDown] = "Page Down"
    }
    return keyNames[keyCode] or keyCode.Name
end

--// Keybind change functionality
local waitingForKey = false
KeybindButton.MouseButton1Click:Connect(function()
    if waitingForKey then return end
    
    waitingForKey = true
    KeybindButton.Text = "Press any key..."
    KeybindButton.BackgroundColor3 = Color3.fromRGB(60, 100, 150)
    
    local connection
    connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if input.UserInputType == Enum.UserInputType.Keyboard then
            -- Update the keybind
            Settings.ToggleKey = input.KeyCode
            KeybindButton.Text = GetKeyName(input.KeyCode) .. " (Click to change)"
            KeybindButton.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
            
            -- Save settings
            SaveSettings()
            
            waitingForKey = false
            connection:Disconnect()
            
            if Settings.SoundFXEnabled then
                ClickSound:Play()
            end
        end
    end)
end)

KeybindButton.MouseEnter:Connect(function()
    if not waitingForKey then
        TweenService:Create(KeybindButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(45, 45, 70)}):Play()
    end
end)

KeybindButton.MouseLeave:Connect(function()
    if not waitingForKey then
        TweenService:Create(KeybindButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 35, 55)}):Play()
    end
end)

--// Mouse Unlock Toggle Section
CreateSectionHeader("üñ±Ô∏è MOUSE UNLOCK SETTINGS", GeneralContent)

local MouseUnlockToggle = Instance.new("TextButton")
MouseUnlockToggle.Size = UDim2.new(1, 0, 0, 45)
MouseUnlockToggle.BackgroundColor3 = Settings.MouseUnlockEnabled and Color3.fromRGB(60, 150, 60) or Color3.fromRGB(150, 60, 60)
MouseUnlockToggle.BorderSizePixel = 0
MouseUnlockToggle.Text = Settings.MouseUnlockEnabled and "üñ±Ô∏è MOUSE UNLOCK: ON" or "üñ±Ô∏è MOUSE UNLOCK: OFF"
MouseUnlockToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
MouseUnlockToggle.Font = Enum.Font.GothamBold
MouseUnlockToggle.TextSize = 14
MouseUnlockToggle.Parent = GeneralContent

Instance.new("UICorner", MouseUnlockToggle).CornerRadius = UDim.new(0, 10)

local MouseUnlockStroke = Instance.new("UIStroke")
MouseUnlockStroke.Color = Settings.MouseUnlockEnabled and Color3.fromRGB(80, 200, 120) or Color3.fromRGB(200, 80, 80)
MouseUnlockStroke.Thickness = 2
MouseUnlockStroke.Parent = MouseUnlockToggle

MouseUnlockToggle.MouseButton1Click:Connect(function()
    Settings.MouseUnlockEnabled = not Settings.MouseUnlockEnabled
    
    if Settings.MouseUnlockEnabled then
        MouseUnlockToggle.Text = "üñ±Ô∏è MOUSE UNLOCK: ON"
        MouseUnlockToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        MouseUnlockStroke.Color = Color3.fromRGB(80, 200, 120)
    else
        MouseUnlockToggle.Text = "üñ±Ô∏è MOUSE UNLOCK: OFF"
        MouseUnlockToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
        MouseUnlockStroke.Color = Color3.fromRGB(200, 80, 80)
        -- Hide custom cursor and restore default mouse when disabled
        CustomCursor.Visible = false
        UserInputService.MouseIconEnabled = true
        UserInputService.MouseBehavior = Enum.MouseBehavior.Default
    end
    
    SaveSettings()
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

MouseUnlockToggle.MouseEnter:Connect(function()
    TweenService:Create(MouseUnlockToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.MouseUnlockEnabled and Color3.fromRGB(70, 180, 70) or Color3.fromRGB(180, 70, 70)
    }):Play()
end)

MouseUnlockToggle.MouseLeave:Connect(function()
    TweenService:Create(MouseUnlockToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.MouseUnlockEnabled and Color3.fromRGB(60, 150, 60) or Color3.fromRGB(150, 60, 60)
    }):Play()
end)

--// ========== MOD DETECTOR TAB CONTENT ==========

--// Create Mod Alarm Sound (custom alarm sound)
local SoundService = game:GetService("SoundService")
local ModAlarmSound = Instance.new("Sound")
ModAlarmSound.Name = "ModAlarmSound"
ModAlarmSound.SoundId = "rbxassetid://9081625499" -- Custom alarm sound
ModAlarmSound.Volume = Settings.ModAlarmVolume / 100 -- Convert to Roblox volume scale
ModAlarmSound.Looped = false
ModAlarmSound.Parent = SoundService

-- Alarm sound initialized

-- Sound loads asynchronously in background

--// Friend Scanning Functions (from mod.txt)
local function getAllFriends(userId)
    local friendIds = {}
    local cursor = nil
    local HttpService = game:GetService("HttpService")
    local requestFunc = request or http_request or (syn and syn.request)
    
    if not requestFunc then
        return friendIds
    end
    
    local success, err = pcall(function()
        repeat
            local url = "https://friends.roblox.com/v1/users/" .. userId .. "/friends?limit=100"
            if cursor then url = url .. "&cursor=" .. cursor end
            
            -- Add small delay between requests to avoid rate limiting
            if cursor then
                task.wait(0.5)
            end
            
            local response = requestFunc({Url = url, Method = "GET"})
            
            if not response or not response.Body then
                return
            end
            
            local data = HttpService:JSONDecode(response.Body)
            
            if not data.data then
                return
            end
            
            for _, friend in ipairs(data.data) do
                table.insert(friendIds, friend.id)
            end
            
            cursor = data.nextPageCursor
        until not cursor
    end)
    
    return friendIds
end

local function scanPlayerFriends(player)
    if not Settings.FriendScanEnabled or not Settings.ModDetectorEnabled then
        return
    end
    
    -- Check if already scanned
    if friendScanCache[player.UserId] then
        return
    end
    
    friendScanCache[player.UserId] = true
    
    task.spawn(function()
        -- Add delay before making API request
        task.wait(1)
        
        local friendIds = getAllFriends(player.UserId)
        
        -- If no friends found, skip silently
        if #friendIds == 0 then
            return
        end
        
        for i, friendId in ipairs(friendIds) do
            
            local foundInList = nil
            local listType = nil
            
            -- Check owner list
            if config.ownerList[friendId] then
                foundInList = friendId
                listType = "Owner"
            -- Check mod list
            elseif config.modWatchList[friendId] then
                foundInList = friendId
                listType = "Moderator"
            -- Check known player list
            elseif config.knownWatchList[friendId] then
                foundInList = friendId
                listType = "Known Player"
            end
            
            if foundInList then
                
                -- Get friend's username
                local friendName = "Unknown"
                pcall(function()
                    if playerInfoCache[friendId] and playerInfoCache[friendId].Name then
                        friendName = playerInfoCache[friendId].Name
                    else
                        FetchUsername(friendId, function(name)
                            friendName = name
                        end)
                        task.wait(0.5) -- Wait for fetch
                    end
                end)
                
                -- Calculate vertical position for stacking (top-right corner)
                local notifIndex = activeNotifications
                activeNotifications = activeNotifications + 1
                local yOffset = 10 + (notifIndex * 150) -- Stack with 10px gap between each
                
                -- Show in-game notification with both avatars
                local NotifGui = Instance.new("ScreenGui")
                NotifGui.Name = "FriendScanNotif"
                NotifGui.ResetOnSpawn = false
                NotifGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                NotifGui.Parent = PlayerGui
                
                local NotifFrame = Instance.new("Frame")
                NotifFrame.Size = UDim2.new(0, 400, 0, 140)
                NotifFrame.Position = UDim2.new(1, 450, 0, -200) -- Start off-screen right
                NotifFrame.BackgroundColor3 = Color3.fromRGB(35, 25, 25)
                NotifFrame.BorderSizePixel = 0
                NotifFrame.Parent = NotifGui
                
                Instance.new("UICorner", NotifFrame).CornerRadius = UDim.new(0, 15)
                
                local NotifStroke = Instance.new("UIStroke")
                NotifStroke.Color = Color3.fromRGB(255, 180, 80)
                NotifStroke.Thickness = 3
                NotifStroke.Parent = NotifFrame
                
                local NotifGradient = Instance.new("UIGradient")
                NotifGradient.Color = ColorSequence.new{
                    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 30, 25)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 20, 20))
                }
                NotifGradient.Rotation = 135
                NotifGradient.Parent = NotifFrame
                
                -- Player Avatar (Person in game)
                local PlayerAvatarContainer = Instance.new("Frame")
                PlayerAvatarContainer.Size = UDim2.new(0, 80, 0, 80)
                PlayerAvatarContainer.Position = UDim2.new(0, 15, 0.5, -40)
                PlayerAvatarContainer.BackgroundColor3 = Color3.fromRGB(255, 180, 80)
                PlayerAvatarContainer.BackgroundTransparency = 0.9
                PlayerAvatarContainer.BorderSizePixel = 0
                PlayerAvatarContainer.Parent = NotifFrame
                
                Instance.new("UICorner", PlayerAvatarContainer).CornerRadius = UDim.new(0, 12)
                
                local PlayerAvatar = Instance.new("ImageLabel")
                PlayerAvatar.Size = UDim2.new(0, 70, 0, 70)
                PlayerAvatar.Position = UDim2.new(0.5, -35, 0.5, -35)
                PlayerAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
                PlayerAvatar.BorderSizePixel = 0
                PlayerAvatar.Parent = PlayerAvatarContainer
                
                Instance.new("UICorner", PlayerAvatar).CornerRadius = UDim.new(0, 10)
                
                pcall(function()
                    local content = Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
                    PlayerAvatar.Image = content
                end)
                
                -- Friend Avatar (Person they have added)
                local FriendAvatarContainer = Instance.new("Frame")
                FriendAvatarContainer.Size = UDim2.new(0, 80, 0, 80)
                FriendAvatarContainer.Position = UDim2.new(1, -95, 0.5, -40)
                FriendAvatarContainer.BackgroundColor3 = listType == "Owner" and Color3.fromRGB(200, 50, 255) or
                                                         listType == "Moderator" and Color3.fromRGB(255, 80, 80) or
                                                         Color3.fromRGB(100, 180, 255)
                FriendAvatarContainer.BackgroundTransparency = 0.9
                FriendAvatarContainer.BorderSizePixel = 0
                FriendAvatarContainer.Parent = NotifFrame
                
                Instance.new("UICorner", FriendAvatarContainer).CornerRadius = UDim.new(0, 12)
                
                local FriendAvatar = Instance.new("ImageLabel")
                FriendAvatar.Size = UDim2.new(0, 70, 0, 70)
                FriendAvatar.Position = UDim2.new(0.5, -35, 0.5, -35)
                FriendAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
                FriendAvatar.BorderSizePixel = 0
                FriendAvatar.Parent = FriendAvatarContainer
                
                Instance.new("UICorner", FriendAvatar).CornerRadius = UDim.new(0, 10)
                
                pcall(function()
                    local content = Players:GetUserThumbnailAsync(foundInList, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
                    FriendAvatar.Image = content
                end)
                
                -- Arrow between avatars
                local Arrow = Instance.new("TextLabel")
                Arrow.Size = UDim2.new(0, 40, 0, 40)
                Arrow.Position = UDim2.new(0.5, -20, 0.5, -20)
                Arrow.BackgroundTransparency = 1
                Arrow.Text = "‚Üí"
                Arrow.TextColor3 = Color3.fromRGB(255, 200, 100)
                Arrow.Font = Enum.Font.GothamBold
                Arrow.TextSize = 35
                Arrow.Parent = NotifFrame
                
                -- Title
                local NotifTitle = Instance.new("TextLabel")
                NotifTitle.Size = UDim2.new(1, -20, 0, 25)
                NotifTitle.Position = UDim2.new(0, 10, 0, 10)
                NotifTitle.BackgroundTransparency = 1
                NotifTitle.Text = "üëÅÔ∏è " .. listType:upper() .. " FRIEND DETECTED"
                NotifTitle.TextColor3 = Color3.fromRGB(255, 200, 100)
                NotifTitle.Font = Enum.Font.GothamBold
                NotifTitle.TextSize = 16
                NotifTitle.TextXAlignment = Enum.TextXAlignment.Center
                NotifTitle.Parent = NotifFrame
                
                -- Player name (left side)
                local PlayerNameLabel = Instance.new("TextLabel")
                PlayerNameLabel.Size = UDim2.new(0, 100, 0, 16)
                PlayerNameLabel.Position = UDim2.new(0, 10, 1, -35)
                PlayerNameLabel.BackgroundTransparency = 1
                PlayerNameLabel.Text = player.Name
                PlayerNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                PlayerNameLabel.Font = Enum.Font.GothamBold
                PlayerNameLabel.TextSize = 12
                PlayerNameLabel.TextXAlignment = Enum.TextXAlignment.Center
                PlayerNameLabel.TextTruncate = Enum.TextTruncate.AtEnd
                PlayerNameLabel.Parent = NotifFrame
                
                -- Player category (left side - under name)
                local PlayerCategoryLabel = Instance.new("TextLabel")
                PlayerCategoryLabel.Size = UDim2.new(0, 100, 0, 14)
                PlayerCategoryLabel.Position = UDim2.new(0, 10, 1, -19)
                PlayerCategoryLabel.BackgroundTransparency = 1
                PlayerCategoryLabel.Text = "In Server"
                PlayerCategoryLabel.TextColor3 = Color3.fromRGB(180, 180, 200)
                PlayerCategoryLabel.Font = Enum.Font.Gotham
                PlayerCategoryLabel.TextSize = 10
                PlayerCategoryLabel.TextXAlignment = Enum.TextXAlignment.Center
                PlayerCategoryLabel.Parent = NotifFrame
                
                -- Friend name (right side)
                local FriendNameLabel = Instance.new("TextLabel")
                FriendNameLabel.Size = UDim2.new(0, 100, 0, 16)
                FriendNameLabel.Position = UDim2.new(1, -110, 1, -35)
                FriendNameLabel.BackgroundTransparency = 1
                FriendNameLabel.Text = friendName
                FriendNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                FriendNameLabel.Font = Enum.Font.GothamBold
                FriendNameLabel.TextSize = 12
                FriendNameLabel.TextXAlignment = Enum.TextXAlignment.Center
                FriendNameLabel.TextTruncate = Enum.TextTruncate.AtEnd
                FriendNameLabel.Parent = NotifFrame
                
                -- Friend category (right side - under name)
                local categoryIcon = listType == "Owner" and "üëë" or listType == "Moderator" and "üõ°Ô∏è" or "üë§"
                local FriendCategoryLabel = Instance.new("TextLabel")
                FriendCategoryLabel.Size = UDim2.new(0, 100, 0, 14)
                FriendCategoryLabel.Position = UDim2.new(1, -110, 1, -19)
                FriendCategoryLabel.BackgroundTransparency = 1
                FriendCategoryLabel.Text = categoryIcon .. " " .. listType
                FriendCategoryLabel.TextColor3 = listType == "Owner" and Color3.fromRGB(220, 120, 255) or
                                                 listType == "Moderator" and Color3.fromRGB(255, 150, 150) or
                                                 Color3.fromRGB(150, 200, 255)
                FriendCategoryLabel.Font = Enum.Font.GothamBold
                FriendCategoryLabel.TextSize = 10
                FriendCategoryLabel.TextXAlignment = Enum.TextXAlignment.Center
                FriendCategoryLabel.Parent = NotifFrame
                
                -- Slide in from right
                TweenService:Create(NotifFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                    Position = UDim2.new(1, -410, 0, yOffset)
                }):Play()
                
                -- Play sound
                if Settings.SoundFXEnabled then
                    ClickSound:Play()
                end
                
                -- Auto dismiss
                task.delay(7, function()
                    TweenService:Create(NotifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                        Position = UDim2.new(1, 450, 0, yOffset)
                    }):Play()
                    task.wait(0.5)
                    NotifGui:Destroy()
                    activeNotifications = activeNotifications - 1
                end)
                
                -- Send webhook (matching mod.txt format)
                if Settings.ModWebhookURL ~= "" then
                    task.spawn(function()
                        pcall(function()
                            local HttpService = game:GetService("HttpService")
                            local requestFunc = request or http_request or (syn and syn.request)
                            
                            -- Get avatars
                            local headshotUrl = ""
                            local renderUrl = ""
                            
                            pcall(function()
                                local res = requestFunc({
                                    Url = string.format("https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=%d&size=420x420&format=Png", player.UserId),
                                    Method = "GET"
                                })
                                local data = HttpService:JSONDecode(res.Body)
                                headshotUrl = data.data[1].imageUrl or ""
                            end)
                            
                            pcall(function()
                                local res = requestFunc({
                                    Url = string.format("https://thumbnails.roblox.com/v1/users/avatar?userIds=%d&size=720x720&format=Png&isCircular=false", friendId),
                                    Method = "GET"
                                })
                                local data = HttpService:JSONDecode(res.Body)
                                renderUrl = data.data[1].imageUrl or ""
                            end)
                            
                            local webhookData = {
                                username = "Roblox Security Logger",
                                embeds = {{
                                    title = "‚ö†Ô∏è " .. listType .. " Friend Detected",
                                    color = 0xFF8800,
                                    author = {name = "Player: " .. player.Name, icon_url = headshotUrl},
                                    thumbnail = {url = headshotUrl},
                                    image = {url = renderUrl},
                                    fields = {
                                        {name = "Player", value = "`" .. player.Name .. "`"},
                                        {name = listType .. " Friend", value = "`" .. friendName .. "`"}
                                    },
                                    footer = {text = os.date("%Y-%m-%d %H:%M:%S")}
                                }}
                            }
                            
                            requestFunc({
                                Url = Settings.ModWebhookURL,
                                Method = "POST",
                                Headers = {["Content-Type"] = "application/json"},
                                Body = HttpService:JSONEncode(webhookData)
                            })
                        end)
                    end)
                end
                
                task.wait(1) -- Rate limit between notifications
            end
        end
    end)
end

-- Check if user has premium access for this tab
if not IsPremium then
    -- Show premium feature message for Mod Detector tab
    local PremiumMessage = Instance.new("TextLabel")
    PremiumMessage.Size = UDim2.new(1, 0, 0, 200)
    PremiumMessage.Position = UDim2.new(0, 0, 0.3, 0)
    PremiumMessage.BackgroundTransparency = 1
    PremiumMessage.Text = "üîí This is a Premium Feature\n\nUpgrade to Premium to access:\n‚Ä¢ Mod Detector\n‚Ä¢ Webhook Notifications\n‚Ä¢ Friend List Scanning\n‚Ä¢ Custom Alarms"
    PremiumMessage.TextColor3 = Color3.fromRGB(255, 200, 100)
    PremiumMessage.Font = Enum.Font.GothamBold
    PremiumMessage.TextSize = 18
    PremiumMessage.TextWrapped = true
    PremiumMessage.Parent = ModDetectorContent
else
    CreateSectionHeader("üõ°Ô∏è MOD DETECTOR SETTINGS", ModDetectorContent)

    --// Mod Detector Toggle
    ModDetectorToggle = Instance.new("TextButton")
ModDetectorToggle.Size = UDim2.new(1, 0, 0, 55)
ModDetectorToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
ModDetectorToggle.BorderSizePixel = 0
ModDetectorToggle.Text = "üõ°Ô∏è MOD DETECTOR: ON"
ModDetectorToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
ModDetectorToggle.Font = Enum.Font.GothamBold
ModDetectorToggle.TextSize = 16
ModDetectorToggle.Parent = ModDetectorContent

Instance.new("UICorner", ModDetectorToggle).CornerRadius = UDim.new(0, 10)

ModDetectorToggleStroke = Instance.new("UIStroke")
ModDetectorToggleStroke.Color = Color3.fromRGB(80, 200, 120)
ModDetectorToggleStroke.Thickness = 2
ModDetectorToggleStroke.Parent = ModDetectorToggle

--// Mod Detector Toggle Functionality
ModDetectorToggle.MouseButton1Click:Connect(function()
    Settings.ModDetectorEnabled = not Settings.ModDetectorEnabled
    
    if Settings.ModDetectorEnabled then
        ModDetectorToggle.Text = "üõ°Ô∏è MOD DETECTOR: ON"
        ModDetectorToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        ModDetectorToggleStroke.Color = Color3.fromRGB(80, 200, 120)
        
        -- Show notification that mod detector is now active
        local NotifGui = Instance.new("ScreenGui")
        NotifGui.Name = "ModDetectorStatusNotif"
        NotifGui.ResetOnSpawn = false
        NotifGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        NotifGui.Parent = PlayerGui
        
        local NotifFrame = Instance.new("Frame")
        NotifFrame.Name = "NotifFrame"
        NotifFrame.Size = UDim2.new(0, 350, 0, 80)
        NotifFrame.Position = UDim2.new(0.5, -175, -0.2, 0)
        NotifFrame.BackgroundColor3 = Color3.fromRGB(25, 35, 25)
        NotifFrame.BorderSizePixel = 0
        NotifFrame.Parent = NotifGui
        
        local NotifCorner = Instance.new("UICorner")
        NotifCorner.CornerRadius = UDim.new(0, 12)
        NotifCorner.Parent = NotifFrame
        
        local NotifStroke = Instance.new("UIStroke")
        NotifStroke.Color = Color3.fromRGB(80, 200, 120)
        NotifStroke.Thickness = 3
        NotifStroke.Parent = NotifFrame
        
        local NotifIcon = Instance.new("TextLabel")
        NotifIcon.Size = UDim2.new(0, 60, 0, 60)
        NotifIcon.Position = UDim2.new(0, 10, 0.5, -30)
        NotifIcon.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        NotifIcon.BackgroundTransparency = 0.8
        NotifIcon.BorderSizePixel = 0
        NotifIcon.Text = "üõ°Ô∏è"
        NotifIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
        NotifIcon.Font = Enum.Font.GothamBold
        NotifIcon.TextSize = 35
        NotifIcon.Parent = NotifFrame
        
        local NotifIconCorner = Instance.new("UICorner")
        NotifIconCorner.CornerRadius = UDim.new(0, 10)
        NotifIconCorner.Parent = NotifIcon
        
        local NotifTitle = Instance.new("TextLabel")
        NotifTitle.Size = UDim2.new(1, -85, 0, 30)
        NotifTitle.Position = UDim2.new(0, 80, 0, 15)
        NotifTitle.BackgroundTransparency = 1
        NotifTitle.Text = "MOD DETECTOR ENABLED"
        NotifTitle.TextColor3 = Color3.fromRGB(150, 255, 150)
        NotifTitle.Font = Enum.Font.GothamBold
        NotifTitle.TextSize = 16
        NotifTitle.TextXAlignment = Enum.TextXAlignment.Left
        NotifTitle.Parent = NotifFrame
        
        local NotifDesc = Instance.new("TextLabel")
        NotifDesc.Size = UDim2.new(1, -85, 0, 25)
        NotifDesc.Position = UDim2.new(0, 80, 0, 45)
        NotifDesc.BackgroundTransparency = 1
        NotifDesc.Text = "‚úÖ Now monitoring for moderators"
        NotifDesc.TextColor3 = Color3.fromRGB(200, 220, 200)
        NotifDesc.Font = Enum.Font.Gotham
        NotifDesc.TextSize = 13
        NotifDesc.TextXAlignment = Enum.TextXAlignment.Left
        NotifDesc.Parent = NotifFrame
        
        -- Slide in animation
        TweenService:Create(NotifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Position = UDim2.new(0.5, -175, 0, 20)
        }):Play()
        
        -- Play sound
        if Settings.SoundFXEnabled then
            SparkleSound:Play()
        end
        
        -- Auto dismiss after 3 seconds
        task.delay(3, function()
            TweenService:Create(NotifFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                Position = UDim2.new(0.5, -175, -0.2, 0)
            }):Play()
            
            task.wait(0.4)
            NotifGui:Destroy()
        end)
    else
        ModDetectorToggle.Text = "üõ°Ô∏è MOD DETECTOR: OFF"
        ModDetectorToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
        ModDetectorToggleStroke.Color = Color3.fromRGB(200, 80, 80)
    end
    
    SaveSettings()
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

ModDetectorToggle.MouseEnter:Connect(function()
    TweenService:Create(ModDetectorToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.ModDetectorEnabled and Color3.fromRGB(70, 180, 70) or Color3.fromRGB(180, 70, 70)
    }):Play()
end)

ModDetectorToggle.MouseLeave:Connect(function()
    TweenService:Create(ModDetectorToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.ModDetectorEnabled and Color3.fromRGB(60, 150, 60) or Color3.fromRGB(150, 60, 60)
    }):Play()
end)

--// Webhook Configuration Section
CreateSectionHeader("üîó WEBHOOK CONFIGURATION", ModDetectorContent)

--// Webhook URL Input
WebhookInput = Instance.new("TextBox")
WebhookInput.Size = UDim2.new(1, 0, 0, 45)
WebhookInput.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
WebhookInput.BorderSizePixel = 0
WebhookInput.Text = Settings.ModWebhookURL
WebhookInput.PlaceholderText = "https://discord.com/api/webhooks/..."
WebhookInput.TextColor3 = Color3.fromRGB(255, 255, 255)
WebhookInput.PlaceholderColor3 = Color3.fromRGB(120, 120, 140)
WebhookInput.Font = Enum.Font.Gotham
WebhookInput.TextSize = 12
WebhookInput.ClearTextOnFocus = false
WebhookInput.TextXAlignment = Enum.TextXAlignment.Left
WebhookInput.Parent = ModDetectorContent

Instance.new("UICorner", WebhookInput).CornerRadius = UDim.new(0, 8)

local WebhookInputPadding = Instance.new("UIPadding")
WebhookInputPadding.PaddingLeft = UDim.new(0, 10)
WebhookInputPadding.PaddingRight = UDim.new(0, 10)
WebhookInputPadding.Parent = WebhookInput

local WebhookInputStroke = Instance.new("UIStroke")
WebhookInputStroke.Color = Color3.fromRGB(80, 80, 120)
WebhookInputStroke.Thickness = 2
WebhookInputStroke.Transparency = 0.7
WebhookInputStroke.Parent = WebhookInput

--// Save webhook on text change
WebhookInput.FocusLost:Connect(function()
    Settings.ModWebhookURL = WebhookInput.Text
    SaveSettings()
end)

--// Webhook Info (directly under input box)
local WebhookInfo = Instance.new("TextLabel")
WebhookInfo.Size = UDim2.new(1, 0, 0, 40)
WebhookInfo.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
WebhookInfo.BorderSizePixel = 0
WebhookInfo.Text = "üí° Enter your Discord webhook URL above to receive notifications when a mod joins"
WebhookInfo.TextColor3 = Color3.fromRGB(200, 200, 220)
WebhookInfo.Font = Enum.Font.Gotham
WebhookInfo.TextSize = 11
WebhookInfo.TextWrapped = true
WebhookInfo.TextXAlignment = Enum.TextXAlignment.Left
WebhookInfo.Parent = ModDetectorContent

Instance.new("UICorner", WebhookInfo).CornerRadius = UDim.new(0, 8)

local WebhookInfoPadding = Instance.new("UIPadding")
WebhookInfoPadding.PaddingLeft = UDim.new(0, 10)
WebhookInfoPadding.PaddingRight = UDim.new(0, 10)
WebhookInfoPadding.Parent = WebhookInfo

--// Test Webhook Button (placed AFTER info box so it appears below)
local TestWebhookButton = Instance.new("TextButton")
TestWebhookButton.Size = UDim2.new(1, 0, 0, 45)
TestWebhookButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
TestWebhookButton.BorderSizePixel = 0
TestWebhookButton.Text = "üîî TEST WEBHOOK"
TestWebhookButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TestWebhookButton.Font = Enum.Font.GothamBold
TestWebhookButton.TextSize = 14
TestWebhookButton.Parent = ModDetectorContent

Instance.new("UICorner", TestWebhookButton).CornerRadius = UDim.new(0, 10)

local TestWebhookStroke = Instance.new("UIStroke")
TestWebhookStroke.Color = Color3.fromRGB(80, 120, 220)
TestWebhookStroke.Thickness = 2
TestWebhookStroke.Parent = TestWebhookButton

TestWebhookButton.MouseButton1Click:Connect(function()
    if Settings.ModWebhookURL ~= "" then
        local success, err = pcall(function()
            local HttpService = game:GetService("HttpService")
            local data = {
                ["embeds"] = {{
                    ["title"] = "üõ°Ô∏è Mod Detector - Test Notification",
                    ["description"] = "‚úÖ Your webhook is working correctly!",
                    ["color"] = 3066993,
                    ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S"),
                    ["footer"] = {
                        ["text"] = "Roblox Rivals Info UI - Mod Detector Test"
                    }
                }}
            }
            local jsonData = HttpService:JSONEncode(data)
            request({
                Url = Settings.ModWebhookURL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = jsonData
            })
        end)
        
        TestWebhookButton.Text = success and "‚úÖ WEBHOOK SENT!" or "‚ùå FAILED TO SEND"
        wait(2)
        TestWebhookButton.Text = "üîî TEST WEBHOOK"
    else
        TestWebhookButton.Text = "‚ö†Ô∏è ENTER WEBHOOK URL FIRST"
        wait(2)
        TestWebhookButton.Text = "üîî TEST WEBHOOK"
    end
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

--// Friend Scanning Section
CreateSectionHeader("üë• FRIEND LIST SCANNING", ModDetectorContent)

--// Friend Scan Toggle
FriendScanToggle = Instance.new("TextButton")
FriendScanToggle.Size = UDim2.new(1, 0, 0, 55)
FriendScanToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
FriendScanToggle.BorderSizePixel = 0
FriendScanToggle.Text = "üë• FRIEND SCAN: ON"
FriendScanToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
FriendScanToggle.Font = Enum.Font.GothamBold
FriendScanToggle.TextSize = 16
FriendScanToggle.Parent = ModDetectorContent

Instance.new("UICorner", FriendScanToggle).CornerRadius = UDim.new(0, 10)

FriendScanToggleStroke = Instance.new("UIStroke")
FriendScanToggleStroke.Color = Color3.fromRGB(80, 200, 120)
FriendScanToggleStroke.Thickness = 2
FriendScanToggleStroke.Parent = FriendScanToggle

--// Friend Scan Toggle Functionality
FriendScanToggle.MouseButton1Click:Connect(function()
    Settings.FriendScanEnabled = not Settings.FriendScanEnabled
    
    if Settings.FriendScanEnabled then
        FriendScanToggle.Text = "üë• FRIEND SCAN: ON"
        FriendScanToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        FriendScanToggleStroke.Color = Color3.fromRGB(80, 200, 120)
    else
        FriendScanToggle.Text = "üë• FRIEND SCAN: OFF"
        FriendScanToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
        FriendScanToggleStroke.Color = Color3.fromRGB(200, 80, 80)
    end
    
    SaveSettings()
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

FriendScanToggle.MouseEnter:Connect(function()
    TweenService:Create(FriendScanToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.FriendScanEnabled and Color3.fromRGB(70, 180, 70) or Color3.fromRGB(180, 70, 70)
    }):Play()
end)

FriendScanToggle.MouseLeave:Connect(function()
    TweenService:Create(FriendScanToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.FriendScanEnabled and Color3.fromRGB(60, 150, 60) or Color3.fromRGB(150, 60, 60)
    }):Play()
end)

--// Friend Scan Info (moved under toggle button)
local FriendScanInfo = Instance.new("TextLabel")
FriendScanInfo.Size = UDim2.new(1, 0, 0, 50)
FriendScanInfo.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
FriendScanInfo.BorderSizePixel = 0
FriendScanInfo.Text = "üí° Scans players' friend lists to detect if they have anyone from the mod/owner/known player lists added"
FriendScanInfo.TextColor3 = Color3.fromRGB(200, 200, 220)
FriendScanInfo.Font = Enum.Font.Gotham
FriendScanInfo.TextSize = 11
FriendScanInfo.TextWrapped = true
FriendScanInfo.TextXAlignment = Enum.TextXAlignment.Left
FriendScanInfo.Parent = ModDetectorContent

Instance.new("UICorner", FriendScanInfo).CornerRadius = UDim.new(0, 8)

local FriendScanInfoPadding = Instance.new("UIPadding")
FriendScanInfoPadding.PaddingLeft = UDim.new(0, 10)
FriendScanInfoPadding.PaddingRight = UDim.new(0, 10)
FriendScanInfoPadding.PaddingTop = UDim.new(0, 8)
FriendScanInfoPadding.PaddingBottom = UDim.new(0, 8)
FriendScanInfoPadding.Parent = FriendScanInfo

--// Mod Alarm Section
CreateSectionHeader("üö® MOD ALARM Volume", ModDetectorContent)

--// Mod Alarm Toggle
ModAlarmToggle = Instance.new("TextButton")
ModAlarmToggle.Size = UDim2.new(1, 0, 0, 55)
ModAlarmToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
ModAlarmToggle.BorderSizePixel = 0
ModAlarmToggle.Text = "üö® MOD ALARM: ON"
ModAlarmToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
ModAlarmToggle.Font = Enum.Font.GothamBold
ModAlarmToggle.TextSize = 16
ModAlarmToggle.Parent = ModDetectorContent

Instance.new("UICorner", ModAlarmToggle).CornerRadius = UDim.new(0, 10)

ModAlarmToggleStroke = Instance.new("UIStroke")
ModAlarmToggleStroke.Color = Color3.fromRGB(80, 200, 120)
ModAlarmToggleStroke.Thickness = 2
ModAlarmToggleStroke.Parent = ModAlarmToggle

--// Mod Alarm Toggle Functionality
ModAlarmToggle.MouseButton1Click:Connect(function()
    Settings.ModAlarmEnabled = not Settings.ModAlarmEnabled
    
    if Settings.ModAlarmEnabled then
        ModAlarmToggle.Text = "üö® MOD ALARM: ON"
        ModAlarmToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        ModAlarmToggleStroke.Color = Color3.fromRGB(80, 200, 120)
    else
        ModAlarmToggle.Text = "üö® MOD ALARM: OFF"
        ModAlarmToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
        ModAlarmToggleStroke.Color = Color3.fromRGB(200, 80, 80)
    end
    
    SaveSettings()
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

ModAlarmToggle.MouseEnter:Connect(function()
    TweenService:Create(ModAlarmToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.ModAlarmEnabled and Color3.fromRGB(70, 180, 70) or Color3.fromRGB(180, 70, 70)
    }):Play()
end)

ModAlarmToggle.MouseLeave:Connect(function()
    TweenService:Create(ModAlarmToggle, TweenInfo.new(0.2), {
        BackgroundColor3 = Settings.ModAlarmEnabled and Color3.fromRGB(60, 150, 60) or Color3.fromRGB(150, 60, 60)
    }):Play()
end)

--// Alarm Volume Control Section
AlarmVolumeLabel = Instance.new("TextLabel")
AlarmVolumeLabel.Size = UDim2.new(1, 0, 0, 35)
AlarmVolumeLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
AlarmVolumeLabel.BorderSizePixel = 0
AlarmVolumeLabel.Text = string.format("üîä ALARM VOLUME: %d / 500", Settings.ModAlarmVolume)
AlarmVolumeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
AlarmVolumeLabel.Font = Enum.Font.GothamBold
AlarmVolumeLabel.TextSize = 14
AlarmVolumeLabel.Parent = ModDetectorContent
Instance.new("UICorner", AlarmVolumeLabel).CornerRadius = UDim.new(0, 8)

--// Volume scale info
local VolumeScaleInfo = Instance.new("TextLabel")
VolumeScaleInfo.Size = UDim2.new(1, 0, 0, 25)
VolumeScaleInfo.BackgroundTransparency = 1
VolumeScaleInfo.Text = "üí° Scale: 1 (Quiet) ‚Üê ‚Üí 500 (Very Loud)"
VolumeScaleInfo.TextColor3 = Color3.fromRGB(150, 150, 170)
VolumeScaleInfo.Font = Enum.Font.Gotham
VolumeScaleInfo.TextSize = 11
VolumeScaleInfo.Parent = ModDetectorContent

--// Alarm Volume Slider Container
local AlarmVolumeSliderContainer = Instance.new("Frame")
AlarmVolumeSliderContainer.Size = UDim2.new(1, 0, 0, 50)
AlarmVolumeSliderContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
AlarmVolumeSliderContainer.BorderSizePixel = 0
AlarmVolumeSliderContainer.Parent = ModDetectorContent
Instance.new("UICorner", AlarmVolumeSliderContainer).CornerRadius = UDim.new(0, 8)

--// Alarm Volume Slider Background
local AlarmVolumeSliderBG = Instance.new("Frame")
AlarmVolumeSliderBG.Name = "SliderBG"
AlarmVolumeSliderBG.Size = UDim2.new(1, -40, 0, 10)
AlarmVolumeSliderBG.Position = UDim2.new(0, 20, 0.5, -5)
AlarmVolumeSliderBG.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
AlarmVolumeSliderBG.BorderSizePixel = 0
AlarmVolumeSliderBG.Parent = AlarmVolumeSliderContainer
Instance.new("UICorner", AlarmVolumeSliderBG).CornerRadius = UDim.new(1, 0)

--// Alarm Volume Slider Fill
AlarmVolumeSliderFill = Instance.new("Frame")
AlarmVolumeSliderFill.Name = "SliderFill"
AlarmVolumeSliderFill.Size = UDim2.new(Settings.ModAlarmVolume / 500, 0, 1, 0)
AlarmVolumeSliderFill.BackgroundColor3 = Color3.fromRGB(255, 120, 120)
AlarmVolumeSliderFill.BorderSizePixel = 0
AlarmVolumeSliderFill.Parent = AlarmVolumeSliderBG
Instance.new("UICorner", AlarmVolumeSliderFill).CornerRadius = UDim.new(1, 0)

--// Alarm Volume Slider Drag Functionality
local AlarmVolumeDragging = false

AlarmVolumeSliderBG.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        AlarmVolumeDragging = true
        local function updateVolume()
            local mousePos = UserInputService:GetMouseLocation().X
            local sliderPos = AlarmVolumeSliderBG.AbsolutePosition.X
            local sliderSize = AlarmVolumeSliderBG.AbsoluteSize.X
            local percentage = math.clamp((mousePos - sliderPos) / sliderSize, 0, 1)
            
            Settings.ModAlarmVolume = math.floor(percentage * 500)
            if Settings.ModAlarmVolume < 1 then Settings.ModAlarmVolume = 1 end
            
            AlarmVolumeSliderFill.Size = UDim2.new(percentage, 0, 1, 0)
            AlarmVolumeLabel.Text = string.format("üîä ALARM VOLUME: %d / 500", Settings.ModAlarmVolume)
            ModAlarmSound.Volume = Settings.ModAlarmVolume / 100
            
            SaveSettings()
        end
        updateVolume()
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        AlarmVolumeDragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and AlarmVolumeDragging then
        local mousePos = UserInputService:GetMouseLocation().X
        local sliderPos = AlarmVolumeSliderBG.AbsolutePosition.X
        local sliderSize = AlarmVolumeSliderBG.AbsoluteSize.X
        local percentage = math.clamp((mousePos - sliderPos) / sliderSize, 0, 1)
        
        Settings.ModAlarmVolume = math.floor(percentage * 500)
        if Settings.ModAlarmVolume < 1 then Settings.ModAlarmVolume = 1 end
        
        AlarmVolumeSliderFill.Size = UDim2.new(percentage, 0, 1, 0)
        AlarmVolumeLabel.Text = string.format("üîä ALARM VOLUME: %d / 500", Settings.ModAlarmVolume)
        ModAlarmSound.Volume = Settings.ModAlarmVolume / 100
    end
end)

--// Test Alarm Button
local TestAlarmButton = Instance.new("TextButton")
TestAlarmButton.Size = UDim2.new(1, 0, 0, 45)
TestAlarmButton.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
TestAlarmButton.BorderSizePixel = 0
TestAlarmButton.Text = "üö® TEST ALARM SOUND"
TestAlarmButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TestAlarmButton.Font = Enum.Font.GothamBold
TestAlarmButton.TextSize = 14
TestAlarmButton.Parent = ModDetectorContent
Instance.new("UICorner", TestAlarmButton).CornerRadius = UDim.new(0, 10)

local TestAlarmStroke = Instance.new("UIStroke")
TestAlarmStroke.Color = Color3.fromRGB(220, 80, 80)
TestAlarmStroke.Thickness = 2
TestAlarmStroke.Parent = TestAlarmButton

TestAlarmButton.MouseButton1Click:Connect(function()
    -- Stop any currently playing alarm
    ModAlarmSound:Stop()
    task.wait(0.1)
    
    -- Update volume to current setting
    ModAlarmSound.Volume = Settings.ModAlarmVolume / 100
    
    -- Try playing
    local success = pcall(function()
        ModAlarmSound:Play()
    end)
    
    if success then
        TestAlarmButton.Text = "üîä PLAYING..."
        task.delay(3, function()
            TestAlarmButton.Text = "üö® TEST ALARM SOUND"
        end)
    else
        TestAlarmButton.Text = "‚ùå SOUND FAILED"
        task.delay(2, function()
            TestAlarmButton.Text = "üö® TEST ALARM SOUND"
        end)
    end
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)
end -- End of IsPremium check for Mod Detector tab

--// ========== KNOWN MODS & PLAYERS TAB CONTENT ==========

--// Function to fetch username from UserID
local function FetchUsername(userId, callback)
    -- Check cache first
    if playerInfoCache[userId] and playerInfoCache[userId].Name ~= "Loading..." then
        callback(playerInfoCache[userId].Name)
        return
    end
    
    -- Try to get player from game first
    local player = Players:GetPlayerByUserId(userId)
    if player then
        if not playerInfoCache[userId] then
            playerInfoCache[userId] = {}
        end
        playerInfoCache[userId].Name = player.Name
        callback(player.Name)
        return
    end
    
    -- Try to fetch from Roblox API
    task.spawn(function()
        local success, username = pcall(function()
            local HttpService = game:GetService("HttpService")
            local url = "https://users.roblox.com/v1/users/" .. userId
            local response = game:HttpGet(url)
            local data = HttpService:JSONDecode(response)
            return data.name or data.displayName or "Unknown"
        end)
        
        if success and username then
            if not playerInfoCache[userId] then
                playerInfoCache[userId] = {}
            end
            playerInfoCache[userId].Name = username
            callback(username)
        else
            callback("User#" .. userId)
        end
    end)
end

CreateSectionHeader("üõ°Ô∏è KNOWN MODERATORS", KnownModsContent)

--// Function to create person info card
local function CreatePersonCard(userId, personType, parent)
    -- personType: "owner", "mod", or "player"
    local threat = personType == "owner" and "Critical" or personType == "mod" and "High" or "Low"
    local role = personType == "owner" and "Game Owner" or personType == "mod" and "Moderator" or "Known Player"
    
    local personCard = Instance.new("Frame")
    personCard.Size = UDim2.new(1, 0, 0, 100)
    personCard.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
    personCard.BorderSizePixel = 0
    personCard.Parent = parent
    
    Instance.new("UICorner", personCard).CornerRadius = UDim.new(0, 10)
    
    local personCardStroke = Instance.new("UIStroke")
    personCardStroke.Color = threat == "Critical" and Color3.fromRGB(200, 50, 255) or
                          threat == "High" and Color3.fromRGB(255, 80, 80) or 
                          threat == "Medium" and Color3.fromRGB(255, 200, 80) or 
                          Color3.fromRGB(100, 180, 255)
    personCardStroke.Thickness = 2
    personCardStroke.Transparency = 0.5
    personCardStroke.Parent = personCard
    
    -- Person avatar
    local personAvatar = Instance.new("ImageLabel")
    personAvatar.Size = UDim2.new(0, 70, 0, 70)
    personAvatar.Position = UDim2.new(0, 10, 0.5, -35)
    personAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    personAvatar.BorderSizePixel = 0
    personAvatar.Parent = personCard
    
    Instance.new("UICorner", personAvatar).CornerRadius = UDim.new(0, 8)
    
    -- Load avatar image
    task.spawn(function()
        pcall(function()
            local content = Players:GetUserThumbnailAsync(userId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
            personAvatar.Image = content
        end)
    end)
    
    -- Person name
    local personName = Instance.new("TextLabel")
    personName.Size = UDim2.new(1, -100, 0, 25)
    personName.Position = UDim2.new(0, 90, 0, 10)
    personName.BackgroundTransparency = 1
    personName.Text = "Loading..."
    personName.TextColor3 = Color3.fromRGB(255, 255, 255)
    personName.Font = Enum.Font.GothamBold
    personName.TextSize = 16
    personName.TextXAlignment = Enum.TextXAlignment.Left
    personName.Parent = personCard
    
    -- Fetch username and update the label
    FetchUsername(userId, function(username)
        personName.Text = username
    end)
    
    -- Person role with category
    local personRole = Instance.new("TextLabel")
    personRole.Size = UDim2.new(1, -100, 0, 20)
    personRole.Position = UDim2.new(0, 90, 0, 35)
    personRole.BackgroundTransparency = 1
    
    -- Show category based on person type
    local categoryIcon = personType == "owner" and "üëë" or personType == "mod" and "üõ°Ô∏è" or "üë§"
    local categoryText = personType == "owner" and "Owner" or personType == "mod" and "Moderator" or "Known Player"
    
    personRole.Text = categoryIcon .. " " .. categoryText
    personRole.TextColor3 = personType == "owner" and Color3.fromRGB(220, 120, 255) or
                            personType == "mod" and Color3.fromRGB(255, 150, 150) or
                            Color3.fromRGB(150, 200, 255)
    personRole.Font = Enum.Font.GothamBold
    personRole.TextSize = 13
    personRole.TextXAlignment = Enum.TextXAlignment.Left
    personRole.Parent = personCard
    
    -- Person user ID
    local personUserId = Instance.new("TextLabel")
    personUserId.Size = UDim2.new(1, -100, 0, 20)
    personUserId.Position = UDim2.new(0, 90, 0, 55)
    personUserId.BackgroundTransparency = 1
    personUserId.Text = "üÜî User ID: " .. userId
    personUserId.TextColor3 = Color3.fromRGB(180, 180, 200)
    personUserId.Font = Enum.Font.Gotham
    personUserId.TextSize = 12
    personUserId.TextXAlignment = Enum.TextXAlignment.Left
    personUserId.Parent = personCard
    
    -- Threat level indicator
    local threatLevel = Instance.new("TextLabel")
    threatLevel.Size = UDim2.new(0, 90, 0, 25)
    threatLevel.Position = UDim2.new(1, -95, 0, 10)
    threatLevel.BackgroundColor3 = threat == "Critical" and Color3.fromRGB(200, 50, 255) or
                                   threat == "High" and Color3.fromRGB(255, 80, 80) or 
                                   threat == "Medium" and Color3.fromRGB(255, 200, 80) or 
                                   Color3.fromRGB(100, 180, 255)
    threatLevel.BorderSizePixel = 0
    threatLevel.Text = threat == "Critical" and "üíÄ CRITICAL" or
                      threat == "High" and "‚ö†Ô∏è HIGH" or 
                      threat == "Medium" and "‚ö° MEDIUM" or 
                      "‚ÑπÔ∏è LOW"
    threatLevel.TextColor3 = Color3.fromRGB(255, 255, 255)
    threatLevel.Font = Enum.Font.GothamBold
    threatLevel.TextSize = 11
    threatLevel.Parent = personCard
    
    Instance.new("UICorner", threatLevel).CornerRadius = UDim.new(0, 6)
    
    return personCard
end

-- Check if user has premium access for player lists
if not IsPremium then
    -- Show premium feature message for Player List tab
    local PremiumMessage = Instance.new("TextLabel")
    PremiumMessage.Size = UDim2.new(1, 0, 0, 200)
    PremiumMessage.Position = UDim2.new(0, 0, 0.3, 0)
    PremiumMessage.BackgroundTransparency = 1
    PremiumMessage.Text = "üîí This is a Premium Feature\n\nUpgrade to Premium to access:\n‚Ä¢ Game Owner List\n‚Ä¢ Moderator List\n‚Ä¢ Known Players List\n‚Ä¢ Full Player Database"
    PremiumMessage.TextColor3 = Color3.fromRGB(255, 200, 100)
    PremiumMessage.Font = Enum.Font.GothamBold
    PremiumMessage.TextSize = 18
    PremiumMessage.TextWrapped = true
    PremiumMessage.Parent = KnownModsContent
else
    --// Count and populate owner list first
    local ownerCount = 0
    for userId, _ in pairs(config.ownerList) do
        CreatePersonCard(userId, "owner", KnownModsContent)
        ownerCount = ownerCount + 1
    end

    --// Count and populate mod watch list
    local modCount = 0
    for userId, _ in pairs(config.modWatchList) do
        CreatePersonCard(userId, "mod", KnownModsContent)
        modCount = modCount + 1
    end

    --// Info text if no mods in list
    if ownerCount == 0 and modCount == 0 then
        local noModsText = Instance.new("TextLabel")
        noModsText.Size = UDim2.new(1, 0, 0, 50)
        noModsText.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
        noModsText.BorderSizePixel = 0
        noModsText.Text = "üìã No known moderators in the list"
        noModsText.TextColor3 = Color3.fromRGB(150, 150, 170)
        noModsText.Font = Enum.Font.Gotham
        noModsText.TextSize = 14
        noModsText.Parent = KnownModsContent
        
        Instance.new("UICorner", noModsText).CornerRadius = UDim.new(0, 8)
    else
        -- Add count label
        local modCountLabel = Instance.new("TextLabel")
        modCountLabel.Size = UDim2.new(1, 0, 0, 30)
        modCountLabel.BackgroundColor3 = Color3.fromRGB(35, 25, 45)
        modCountLabel.BorderSizePixel = 0
        modCountLabel.Text = string.format("üìä Owners: %d | Moderators: %d | Total: %d", ownerCount, modCount, ownerCount + modCount)
        modCountLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
        modCountLabel.Font = Enum.Font.GothamBold
        modCountLabel.TextSize = 13
        modCountLabel.Parent = KnownModsContent
        
        Instance.new("UICorner", modCountLabel).CornerRadius = UDim.new(0, 8)
    end

    --// Known Players Section
    CreateSectionHeader("üë• KNOWN PLAYERS", KnownModsContent)

    --// Count and populate known player watch list
    local playerCount = 0
    for userId, _ in pairs(config.knownWatchList) do
        CreatePersonCard(userId, "player", KnownModsContent)
        playerCount = playerCount + 1
    end

    --// Info text if no known players in list
    if playerCount == 0 then
        local noPlayersText = Instance.new("TextLabel")
        noPlayersText.Size = UDim2.new(1, 0, 0, 50)
        noPlayersText.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
        noPlayersText.BorderSizePixel = 0
        noPlayersText.Text = "üìã No known players in the list"
        noPlayersText.TextColor3 = Color3.fromRGB(150, 150, 170)
        noPlayersText.Font = Enum.Font.Gotham
        noPlayersText.TextSize = 14
        noPlayersText.Parent = KnownModsContent
        
        Instance.new("UICorner", noPlayersText).CornerRadius = UDim.new(0, 8)
    else
        -- Add count label
        local playerCountLabel = Instance.new("TextLabel")
        playerCountLabel.Size = UDim2.new(1, 0, 0, 30)
        playerCountLabel.BackgroundColor3 = Color3.fromRGB(25, 35, 45)
        playerCountLabel.BorderSizePixel = 0
        playerCountLabel.Text = string.format("üìä Total Known Players: %d", playerCount)
        playerCountLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
        playerCountLabel.Font = Enum.Font.GothamBold
        playerCountLabel.TextSize = 13
        playerCountLabel.Parent = KnownModsContent
        
        Instance.new("UICorner", playerCountLabel).CornerRadius = UDim.new(0, 8)
    end
end -- End of IsPremium check for Known Mods/Players tab

--// ========== MUSIC TAB CONTENT ==========

-- Check if user has premium access for Music tab
if not IsPremium then
    -- Show premium feature message for Music tab
    local PremiumMessage = Instance.new("TextLabel")
    PremiumMessage.Size = UDim2.new(1, 0, 0, 200)
    PremiumMessage.Position = UDim2.new(0, 0, 0.3, 0)
    PremiumMessage.BackgroundTransparency = 1
    PremiumMessage.Text = "üîí This is a Premium Feature\n\nUpgrade to Premium to access:\n‚Ä¢ Background Music Player\n‚Ä¢ Custom Track Upload\n‚Ä¢ Volume Controls\n‚Ä¢ Playback Modes"
    PremiumMessage.TextColor3 = Color3.fromRGB(255, 200, 100)
    PremiumMessage.Font = Enum.Font.GothamBold
    PremiumMessage.TextSize = 18
    PremiumMessage.TextWrapped = true
    PremiumMessage.Parent = MusicContent
else
    CreateSectionHeader("üéµ MUSIC PLAYER", MusicContent)

--// Playback mode buttons container
local PlaybackModeContainer = Instance.new("Frame")
PlaybackModeContainer.Size = UDim2.new(1, 0, 0, 45)
PlaybackModeContainer.BackgroundTransparency = 1
PlaybackModeContainer.Parent = MusicContent

PlayOrderButton = Instance.new("TextButton")
PlayOrderButton.Size = UDim2.new(0.48, 0, 1, 0)
PlayOrderButton.Position = UDim2.new(0, 0, 0, 0)
PlayOrderButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
PlayOrderButton.BorderSizePixel = 0
PlayOrderButton.Text = "‚ñ∂Ô∏è PLAY IN ORDER"
PlayOrderButton.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayOrderButton.Font = Enum.Font.GothamBold
PlayOrderButton.TextSize = 14
PlayOrderButton.Parent = PlaybackModeContainer

Instance.new("UICorner", PlayOrderButton).CornerRadius = UDim.new(0, 8)

PlayOrderStroke = Instance.new("UIStroke")
PlayOrderStroke.Color = Color3.fromRGB(80, 120, 220)
PlayOrderStroke.Thickness = 2
PlayOrderStroke.Transparency = 0
PlayOrderStroke.Parent = PlayOrderButton

PlayRandomButton = Instance.new("TextButton")
PlayRandomButton.Size = UDim2.new(0.48, 0, 1, 0)
PlayRandomButton.Position = UDim2.new(0.52, 0, 0, 0)
PlayRandomButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
PlayRandomButton.BorderSizePixel = 0
PlayRandomButton.Text = "üîÄ PLAY RANDOM"
PlayRandomButton.TextColor3 = Color3.fromRGB(180, 180, 200)
PlayRandomButton.Font = Enum.Font.GothamBold
PlayRandomButton.TextSize = 14
PlayRandomButton.Parent = PlaybackModeContainer

Instance.new("UICorner", PlayRandomButton).CornerRadius = UDim.new(0, 8)

PlayRandomStroke = Instance.new("UIStroke")
PlayRandomStroke.Color = Color3.fromRGB(60, 60, 90)
PlayRandomStroke.Thickness = 2
PlayRandomStroke.Transparency = 0.7
PlayRandomStroke.Parent = PlayRandomButton

PlayOrderButton.MouseButton1Click:Connect(function()
    Settings.PlaybackMode = "order"
    SaveSettings()
    -- Update button appearances
    PlayOrderButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
    PlayOrderButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    PlayOrderStroke.Transparency = 0
    PlayOrderStroke.Color = Color3.fromRGB(80, 120, 220)
    
    PlayRandomButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    PlayRandomButton.TextColor3 = Color3.fromRGB(180, 180, 200)
    PlayRandomStroke.Transparency = 0.7
    PlayRandomStroke.Color = Color3.fromRGB(60, 60, 90)
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

PlayRandomButton.MouseButton1Click:Connect(function()
    Settings.PlaybackMode = "random"
    SaveSettings()
    -- Update button appearances
    PlayRandomButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
    PlayRandomButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    PlayRandomStroke.Transparency = 0
    PlayRandomStroke.Color = Color3.fromRGB(80, 120, 220)
    
    PlayOrderButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    PlayOrderButton.TextColor3 = Color3.fromRGB(180, 180, 200)
    PlayOrderStroke.Transparency = 0.7
    PlayOrderStroke.Color = Color3.fromRGB(60, 60, 90)
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

--// Collapse state
local isCollapsed = false

--// Background Music
BackgroundMusic = Instance.new("Sound")
BackgroundMusic.Name = "BackgroundMusic"
BackgroundMusic.Volume = Settings.MusicVolume / 100 -- Convert from 1-500 scale to Roblox 0.01-5.0
BackgroundMusic.Looped = true
BackgroundMusic.Parent = SoundContainer

--// Create Music Toggle Button (after BackgroundMusic is defined)
MusicToggle = Instance.new("TextButton")
MusicToggle.Size = UDim2.new(1, 0, 0, 55)
MusicToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
MusicToggle.BorderSizePixel = 0
MusicToggle.Text = "‚ñ∂Ô∏è PLAY MUSIC"
MusicToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
MusicToggle.Font = Enum.Font.GothamBold
MusicToggle.TextSize = 18
MusicToggle.Parent = MusicContent

Instance.new("UICorner", MusicToggle).CornerRadius = UDim.new(0, 10)

MusicStroke = Instance.new("UIStroke")
MusicStroke.Color = Color3.fromRGB(80, 200, 120)
MusicStroke.Thickness = 2
MusicStroke.Parent = MusicToggle

--// Volume Slider Section
local VolumeContainer = Instance.new("Frame")
VolumeContainer.Size = UDim2.new(1, 0, 0, 70)
VolumeContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
VolumeContainer.BorderSizePixel = 0
VolumeContainer.Parent = MusicContent

Instance.new("UICorner", VolumeContainer).CornerRadius = UDim.new(0, 10)

VolumeLabel = Instance.new("TextLabel")
VolumeLabel.Size = UDim2.new(1, -20, 0, 25)
VolumeLabel.Position = UDim2.new(0, 10, 0, 5)
VolumeLabel.BackgroundTransparency = 1
VolumeLabel.Text = "üîä Volume: " .. Settings.MusicVolume
VolumeLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
VolumeLabel.Font = Enum.Font.GothamBold
VolumeLabel.TextSize = 14
VolumeLabel.TextXAlignment = Enum.TextXAlignment.Left
VolumeLabel.Parent = VolumeContainer

-- Slider background
local SliderBG = Instance.new("TextButton")
SliderBG.Size = UDim2.new(1, -20, 0, 8)
SliderBG.Position = UDim2.new(0, 10, 0, 40)
SliderBG.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
SliderBG.BorderSizePixel = 0
SliderBG.Text = ""
SliderBG.AutoButtonColor = false
SliderBG.Parent = VolumeContainer

Instance.new("UICorner", SliderBG).CornerRadius = UDim.new(0, 4)

-- Slider fill
SliderFill = Instance.new("Frame")
SliderFill.Size = UDim2.new((Settings.MusicVolume - 1) / 999, 0, 1, 0) -- Scale from 1-1000
SliderFill.BackgroundColor3 = Color3.fromRGB(80, 150, 255)
SliderFill.BorderSizePixel = 0
SliderFill.Parent = SliderBG

Instance.new("UICorner", SliderFill).CornerRadius = UDim.new(0, 4)

-- Slider button
SliderButton = Instance.new("TextButton")
SliderButton.Size = UDim2.new(0, 20, 0, 20)
SliderButton.Position = UDim2.new((Settings.MusicVolume - 1) / 999, -10, 0.5, -10)
SliderButton.BackgroundColor3 = Color3.fromRGB(120, 180, 255)
SliderButton.BorderSizePixel = 0
SliderButton.Text = ""
SliderButton.Parent = SliderBG

local SliderButtonCorner = Instance.new("UICorner")
SliderButtonCorner.CornerRadius = UDim.new(1, 0)
SliderButtonCorner.Parent = SliderButton

-- Slider dragging functionality
local draggingSlider = false

SliderButton.MouseButton1Down:Connect(function()
    draggingSlider = true
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSlider = false
    end
end)

SliderBG.MouseButton1Down:Connect(function()
    draggingSlider = true
end)

UserInputService.InputChanged:Connect(function(input)
    if draggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then
        local mousePos = UserInputService:GetMouseLocation()
        local sliderPos = SliderBG.AbsolutePosition
        local sliderSize = SliderBG.AbsoluteSize
        
        -- Calculate percentage (0 to 1)
        local percent = math.clamp((mousePos.X - sliderPos.X) / sliderSize.X, 0, 1)
        
        -- Convert to volume (1 to 1000)
        local volume = math.floor(1 + (percent * 999))
        Settings.MusicVolume = volume
        
        -- Update Roblox volume (0.01 to 10.0)
        BackgroundMusic.Volume = volume / 100
        
        -- Update UI
        VolumeLabel.Text = "üîä Volume: " .. volume
        SliderFill.Size = UDim2.new(percent, 0, 1, 0)
        SliderButton.Position = UDim2.new(percent, -10, 0.5, -10)
        
        -- Save settings
        SaveSettings()
    end
end)

--// Function to play next track based on playback mode
local function PlayNextTrack()
    if #MusicTracks == 0 then
        -- No tracks available
        return
    end
    
    if Settings.PlaybackMode == "random" then
        Settings.CurrentMusic = math.random(1, #MusicTracks)
    else -- "order"
        Settings.CurrentMusic = Settings.CurrentMusic + 1
        if Settings.CurrentMusic > #MusicTracks then
            Settings.CurrentMusic = 1
        end
    end
    
    if MusicTracks[Settings.CurrentMusic] and MusicTracks[Settings.CurrentMusic].ID then
        BackgroundMusic.SoundId = MusicTracks[Settings.CurrentMusic].ID
        BackgroundMusic:Play()
        -- Now playing music
    end
end

--// Handle music ending to auto-play next track
BackgroundMusic.Ended:Connect(function()
    if Settings.MusicEnabled then
        PlayNextTrack()
    end
end)

MusicToggle.MouseButton1Click:Connect(function()
    Settings.MusicEnabled = not Settings.MusicEnabled
    if Settings.MusicEnabled then
        MusicToggle.Text = "‚è∏Ô∏è STOP MUSIC"
        MusicToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
        MusicStroke.Color = Color3.fromRGB(200, 80, 80)
        -- Play track based on playback mode
        if #MusicTracks > 0 then
            PlayNextTrack()
        else
            -- No tracks available
            Settings.MusicEnabled = false
            MusicToggle.Text = "‚ñ∂Ô∏è PLAY MUSIC"
            MusicToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
            MusicStroke.Color = Color3.fromRGB(80, 200, 120)
        end
    else
        MusicToggle.Text = "‚ñ∂Ô∏è PLAY MUSIC"
        MusicToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        MusicStroke.Color = Color3.fromRGB(80, 200, 120)
        BackgroundMusic:Stop()
    end
    SaveSettings()
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

MusicToggle.MouseEnter:Connect(function()
    if Settings.MusicEnabled then
        TweenService:Create(MusicToggle, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(180, 70, 70)}):Play()
    else
        TweenService:Create(MusicToggle, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 180, 70)}):Play()
    end
end)

MusicToggle.MouseLeave:Connect(function()
    if Settings.MusicEnabled then
        TweenService:Create(MusicToggle, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(150, 60, 60)}):Play()
    else
        TweenService:Create(MusicToggle, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 150, 60)}):Play()
    end
end)

--// Function to show modern mod detection notification
local function ShowModNotification(playerName, userId, personType)
    -- personType: "owner", "mod", or "player"
    local threat = personType == "owner" and "Critical" or personType == "mod" and "High" or "Low"
    local role = personType == "owner" and "Game Owner" or personType == "mod" and "Moderator" or "Known Player"
    local titleText = personType == "owner" and "üëë GAME OWNER DETECTED!" or 
                     personType == "mod" and "üõ°Ô∏è MODERATOR DETECTED!" or 
                     "üë• KNOWN PLAYER DETECTED!"
    
    -- Create notification GUI
    local NotifGui = Instance.new("ScreenGui")
    NotifGui.Name = "ModDetectorNotif"
    NotifGui.ResetOnSpawn = false
    NotifGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    NotifGui.Parent = PlayerGui
    
    local NotifFrame = Instance.new("Frame")
    NotifFrame.Name = "NotifFrame"
    NotifFrame.Size = UDim2.new(0, 450, 0, 120)
    NotifFrame.Position = UDim2.new(0.5, -225, -0.2, 0)
    NotifFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    NotifFrame.BorderSizePixel = 0
    NotifFrame.Parent = NotifGui
    
    local NotifCorner = Instance.new("UICorner")
    NotifCorner.CornerRadius = UDim.new(0, 15)
    NotifCorner.Parent = NotifFrame
    
    local NotifStroke = Instance.new("UIStroke")
    NotifStroke.Color = threat == "Critical" and Color3.fromRGB(200, 50, 255) or
                        threat == "High" and Color3.fromRGB(255, 80, 80) or 
                        threat == "Medium" and Color3.fromRGB(255, 200, 80) or 
                        Color3.fromRGB(100, 180, 255)
    NotifStroke.Thickness = 3
    NotifStroke.Parent = NotifFrame
    
    local NotifGradient = Instance.new("UIGradient")
    NotifGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 25, 35)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 20, 30))
    }
    NotifGradient.Rotation = 135
    NotifGradient.Parent = NotifFrame
    
    -- Icon container
    local IconContainer = Instance.new("Frame")
    IconContainer.Name = "IconContainer"
    IconContainer.Size = UDim2.new(0, 80, 0, 80)
    IconContainer.Position = UDim2.new(0, 15, 0.5, -40)
    IconContainer.BackgroundColor3 = threat == "Critical" and Color3.fromRGB(200, 50, 255) or
                                     threat == "High" and Color3.fromRGB(255, 80, 80) or 
                                     threat == "Medium" and Color3.fromRGB(255, 200, 80) or 
                                     Color3.fromRGB(100, 180, 255)
    IconContainer.BackgroundTransparency = 0.9
    IconContainer.BorderSizePixel = 0
    IconContainer.Parent = NotifFrame
    
    local IconCorner = Instance.new("UICorner")
    IconCorner.CornerRadius = UDim.new(0, 12)
    IconCorner.Parent = IconContainer
    
    -- Player avatar
    local PlayerAvatar = Instance.new("ImageLabel")
    PlayerAvatar.Size = UDim2.new(0, 70, 0, 70)
    PlayerAvatar.Position = UDim2.new(0.5, -35, 0.5, -35)
    PlayerAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    PlayerAvatar.BorderSizePixel = 0
    PlayerAvatar.Parent = IconContainer
    
    local AvatarCorner = Instance.new("UICorner")
    AvatarCorner.CornerRadius = UDim.new(0, 10)
    AvatarCorner.Parent = PlayerAvatar
    
    pcall(function()
        local content = Players:GetUserThumbnailAsync(userId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
        PlayerAvatar.Image = content
    end)
    
    -- Title
    local NotifTitle = Instance.new("TextLabel")
    NotifTitle.Size = UDim2.new(1, -115, 0, 30)
    NotifTitle.Position = UDim2.new(0, 105, 0, 15)
    NotifTitle.BackgroundTransparency = 1
    NotifTitle.Text = titleText
    NotifTitle.TextColor3 = threat == "Critical" and Color3.fromRGB(220, 120, 255) or
                           threat == "High" and Color3.fromRGB(255, 100, 100) or 
                           threat == "Medium" and Color3.fromRGB(255, 220, 100) or 
                           Color3.fromRGB(150, 200, 255)
    NotifTitle.Font = Enum.Font.GothamBold
    NotifTitle.TextSize = 18
    NotifTitle.TextXAlignment = Enum.TextXAlignment.Left
    NotifTitle.Parent = NotifFrame
    
    -- Player name
    local NotifPlayerName = Instance.new("TextLabel")
    NotifPlayerName.Size = UDim2.new(1, -115, 0, 25)
    NotifPlayerName.Position = UDim2.new(0, 105, 0, 45)
    NotifPlayerName.BackgroundTransparency = 1
    NotifPlayerName.Text = "üë§ " .. playerName
    NotifPlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
    NotifPlayerName.Font = Enum.Font.GothamBold
    NotifPlayerName.TextSize = 15
    NotifPlayerName.TextXAlignment = Enum.TextXAlignment.Left
    NotifPlayerName.Parent = NotifFrame
    
    -- Role
    local NotifRole = Instance.new("TextLabel")
    NotifRole.Size = UDim2.new(1, -115, 0, 20)
    NotifRole.Position = UDim2.new(0, 105, 0, 70)
    NotifRole.BackgroundTransparency = 1
    NotifRole.Text = "üîπ " .. role
    NotifRole.TextColor3 = Color3.fromRGB(180, 180, 220)
    NotifRole.Font = Enum.Font.Gotham
    NotifRole.TextSize = 13
    NotifRole.TextXAlignment = Enum.TextXAlignment.Left
    NotifRole.Parent = NotifFrame
    
    -- Threat level
    local ThreatBadge = Instance.new("TextLabel")
    ThreatBadge.Size = UDim2.new(0, 100, 0, 25)
    ThreatBadge.Position = UDim2.new(0, 105, 0, 90)
    ThreatBadge.BackgroundColor3 = threat == "Critical" and Color3.fromRGB(200, 50, 255) or
                                   threat == "High" and Color3.fromRGB(255, 80, 80) or 
                                   threat == "Medium" and Color3.fromRGB(255, 200, 80) or 
                                   Color3.fromRGB(100, 180, 255)
    ThreatBadge.BorderSizePixel = 0
    ThreatBadge.Text = threat == "Critical" and "üíÄ CRITICAL" or
                      threat == "High" and "‚ö†Ô∏è HIGH THREAT" or 
                      threat == "Medium" and "‚ö° MEDIUM THREAT" or 
                      "‚ÑπÔ∏è LOW THREAT"
    ThreatBadge.TextColor3 = Color3.fromRGB(255, 255, 255)
    ThreatBadge.Font = Enum.Font.GothamBold
    ThreatBadge.TextSize = 11
    ThreatBadge.Parent = NotifFrame
    
    local ThreatCorner = Instance.new("UICorner")
    ThreatCorner.CornerRadius = UDim.new(0, 6)
    ThreatCorner.Parent = ThreatBadge
    
    -- Slide in animation
    TweenService:Create(NotifFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(0.5, -225, 0, 20)
    }):Play()
    
    -- Play alarm sound if enabled (only for owners and mods, not known players)
    if Settings.ModAlarmEnabled and (personType == "owner" or personType == "mod") then
        ModAlarmSound:Stop()
        ModAlarmSound:Play()
    elseif Settings.SoundFXEnabled then
        -- Play regular sound for known players
        SparkleSound:Play()
    end
    
    -- Auto dismiss after 5 seconds
    task.delay(5, function()
        TweenService:Create(NotifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Position = UDim2.new(0.5, -225, -0.2, 0)
        }):Play()
        
        task.wait(0.5)
        NotifGui:Destroy()
    end)
    
    -- Send webhook notification if configured (using original mod.txt format)
    if Settings.ModWebhookURL ~= "" then
        task.spawn(function()
            pcall(function()
                local HttpService = game:GetService("HttpService")
                local requestFunc = request or http_request or (syn and syn.request)
                
                -- Get headshot URL
                local headshotUrl = ""
                pcall(function()
                    local res = requestFunc({
                        Url = string.format("https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=%d&size=420x420&format=Png", userId),
                        Method = "GET"
                    })
                    local data = HttpService:JSONDecode(res.Body)
                    headshotUrl = data.data[1].imageUrl or ""
                end)
                
                -- Get render/full body avatar URL
                local renderUrl = ""
                pcall(function()
                    local res = requestFunc({
                        Url = string.format("https://thumbnails.roblox.com/v1/users/avatar?userIds=%d&size=720x720&format=Png&isCircular=false", userId),
                        Method = "GET"
                    })
                    local data = HttpService:JSONDecode(res.Body)
                    renderUrl = data.data[1].imageUrl or ""
                end)
                
                -- Determine title based on person type
                local webhookTitle = personType == "owner" and "Game Owner Detected" or 
                                    personType == "mod" and "Moderator Detected" or 
                                    "Known Player Detected"
                
                -- Build webhook payload matching original mod.txt format
                local webhookData = {
                    username = "Roblox Security Logger",
                    embeds = {{
                        title = "‚ö†Ô∏è " .. webhookTitle,
                        color = 0xFF8800,
                        author = {
                            name = "Player: " .. playerName,
                            icon_url = headshotUrl
                        },
                        thumbnail = {
                            url = headshotUrl
                        },
                        image = {
                            url = renderUrl
                        },
                        fields = {
                            {name = "Username", value = "`" .. playerName .. "`"},
                            {name = "User ID", value = "`" .. tostring(userId) .. "`"},
                            {name = "Role", value = "`" .. role .. "`"},
                            {name = "Threat Level", value = "`" .. threat .. "`"}
                        },
                        footer = {
                            text = os.date("%Y-%m-%d %H:%M:%S")
                        }
                    }}
                }
                
                local jsonData = HttpService:JSONEncode(webhookData)
                requestFunc({
                    Url = Settings.ModWebhookURL,
                    Method = "POST",
                    Headers = {["Content-Type"] = "application/json"},
                    Body = jsonData
                })
            end)
        end)
    end
end

--// Apply loaded settings to UI elements
task.defer(function()
    -- Update keybind button text with loaded keybind
    KeybindButton.Text = GetKeyName(Settings.ToggleKey) .. " (Click to change)"
    
    -- Update Mouse Unlock Toggle appearance based on loaded settings
    if Settings.MouseUnlockEnabled then
        MouseUnlockToggle.Text = "üñ±Ô∏è MOUSE UNLOCK: ON"
        MouseUnlockToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        MouseUnlockStroke.Color = Color3.fromRGB(80, 200, 120)
    else
        MouseUnlockToggle.Text = "üñ±Ô∏è MOUSE UNLOCK: OFF"
        MouseUnlockToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
        MouseUnlockStroke.Color = Color3.fromRGB(200, 80, 80)
    end
    
    -- Don't touch mouse settings on startup - let game control it naturally
    -- Custom cursor starts hidden and only shows when needed
    CustomCursor.Visible = false
    
    -- Update Mod Detector Toggle appearance based on loaded settings (only for premium users)
    if IsPremium then
        if Settings.ModDetectorEnabled then
            ModDetectorToggle.Text = "üõ°Ô∏è MOD DETECTOR: ON"
            ModDetectorToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
            ModDetectorToggleStroke.Color = Color3.fromRGB(80, 200, 120)
        else
            ModDetectorToggle.Text = "üõ°Ô∏è MOD DETECTOR: OFF"
            ModDetectorToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
            ModDetectorToggleStroke.Color = Color3.fromRGB(200, 80, 80)
        end
        
        -- Update Webhook Input with loaded URL
        WebhookInput.Text = Settings.ModWebhookURL
        
        -- Update Mod Alarm Toggle appearance based on loaded settings
        if Settings.ModAlarmEnabled then
            ModAlarmToggle.Text = "üö® MOD ALARM: ON"
            ModAlarmToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
            ModAlarmToggleStroke.Color = Color3.fromRGB(80, 200, 120)
        else
            ModAlarmToggle.Text = "üö® MOD ALARM: OFF"
            ModAlarmToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
            ModAlarmToggleStroke.Color = Color3.fromRGB(200, 80, 80)
        end
    end
    
    -- Update Alarm Volume UI and sound (only for premium users)
    if IsPremium then
        AlarmVolumeLabel.Text = string.format("üö® ALARM VOLUME: %d / 500", Settings.ModAlarmVolume)
        AlarmVolumeSliderFill.Size = UDim2.new(Settings.ModAlarmVolume / 500, 0, 1, 0)
        ModAlarmSound.Volume = Settings.ModAlarmVolume / 100
        
        -- Update Friend Scan Toggle appearance based on loaded settings
        if Settings.FriendScanEnabled then
            FriendScanToggle.Text = "üë• FRIEND SCAN: ON"
            FriendScanToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
            FriendScanToggleStroke.Color = Color3.fromRGB(80, 200, 120)
        else
            FriendScanToggle.Text = "üë• FRIEND SCAN: OFF"
            FriendScanToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
            FriendScanToggleStroke.Color = Color3.fromRGB(200, 80, 80)
        end
    end
    
    -- Update Volume Slider and Label with loaded volume (only for premium users)
    if IsPremium then
        VolumeLabel.Text = "üéµ Volume: " .. Settings.MusicVolume
        local volumePercent = (Settings.MusicVolume - 1) / 999
        SliderFill.Size = UDim2.new(volumePercent, 0, 1, 0)
        SliderButton.Position = UDim2.new(volumePercent, -10, 0.5, -10)
        BackgroundMusic.Volume = Settings.MusicVolume / 100
        
        -- Update playback mode buttons based on loaded settings
        if Settings.PlaybackMode == "random" then
            PlayRandomButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
            PlayRandomButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        PlayRandomStroke.Transparency = 0
        PlayRandomStroke.Color = Color3.fromRGB(80, 120, 220)
        
        PlayOrderButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        PlayOrderButton.TextColor3 = Color3.fromRGB(180, 180, 200)
        PlayOrderStroke.Transparency = 0.7
        PlayOrderStroke.Color = Color3.fromRGB(60, 60, 90)
    else -- "order" is default
        PlayOrderButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
        PlayOrderButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        PlayOrderStroke.Transparency = 0
        PlayOrderStroke.Color = Color3.fromRGB(80, 120, 220)
        
            PlayRandomButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
            PlayRandomButton.TextColor3 = Color3.fromRGB(180, 180, 200)
            PlayRandomStroke.Transparency = 0.7
            PlayRandomStroke.Color = Color3.fromRGB(60, 60, 90)
        end
    end
    
    -- Update Music toggle appearance based on loaded settings (only for premium users)
    if IsPremium then
        if Settings.MusicEnabled then
            MusicToggle.Text = "üîá STOP MUSIC"
            MusicToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
            MusicStroke.Color = Color3.fromRGB(200, 80, 80)
            -- Auto-play saved music if enabled
            if MusicTracks[Settings.CurrentMusic] and MusicTracks[Settings.CurrentMusic].ID then
                BackgroundMusic.SoundId = MusicTracks[Settings.CurrentMusic].ID
                BackgroundMusic:Play()
            elseif #MusicTracks > 0 then
                -- If saved track doesn't exist, play first track
                Settings.CurrentMusic = 1
                BackgroundMusic.SoundId = MusicTracks[1].ID
                BackgroundMusic:Play()
            end
        else
            MusicToggle.Text = "üéµ PLAY MUSIC"
            MusicToggle.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
            MusicStroke.Color = Color3.fromRGB(80, 200, 120)
        end
    end
    
    -- Settings applied
end)

--// Function to refresh/rebuild music track list
local function RefreshMusicList()
    -- Clear existing track buttons (but keep the add music UI at top)
    for _, child in pairs(MusicContent:GetChildren()) do
        if child:IsA("TextButton") and child.Name == "TrackButton" then
            child:Destroy()
        end
    end
    
    -- Recreate all track buttons (display only, no selection)
    for i, track in ipairs(MusicTracks) do
        local TrackButton = Instance.new("TextButton")
        TrackButton.Name = "TrackButton"
        TrackButton.Size = UDim2.new(1, 0, 0, 45)
        TrackButton.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
        TrackButton.BorderSizePixel = 0
        TrackButton.Text = "üéµ  " .. track.Name .. "  ‚Ä¢  " .. track.Genre
        TrackButton.TextColor3 = Color3.fromRGB(180, 180, 200)
        TrackButton.Font = Enum.Font.Gotham
        TrackButton.TextSize = 13
        TrackButton.TextXAlignment = Enum.TextXAlignment.Left
        TrackButton.TextTruncate = Enum.TextTruncate.AtEnd
        TrackButton.Parent = MusicContent
        
        -- Add padding to text
        local TextPadding = Instance.new("UIPadding")
        TextPadding.PaddingLeft = UDim.new(0, 10)
        TextPadding.Parent = TrackButton
        
        local TrackCorner = Instance.new("UICorner")
        TrackCorner.CornerRadius = UDim.new(0, 8)
        TrackCorner.Parent = TrackButton
        
        local TrackStroke = Instance.new("UIStroke")
        TrackStroke.Color = Color3.fromRGB(60, 60, 90)
        TrackStroke.Thickness = 1
        TrackStroke.Transparency = 0.7
        TrackStroke.Parent = TrackButton
        
        -- Store index properly to avoid closure issues
        local trackIndex = i
        
        -- Click to play this song
        TrackButton.MouseButton1Click:Connect(function()
            -- Enable music if not already enabled
            if not Settings.MusicEnabled then
                Settings.MusicEnabled = true
                MusicToggle.Text = "‚è∏Ô∏è STOP MUSIC"
                MusicToggle.BackgroundColor3 = Color3.fromRGB(150, 60, 60)
                MusicStroke.Color = Color3.fromRGB(200, 80, 80)
            end
            
            -- Play the clicked track
            Settings.CurrentMusic = trackIndex
            BackgroundMusic.SoundId = track.ID
            BackgroundMusic:Play()
            
            if Settings.SoundFXEnabled then
                ClickSound:Play()
            end
            
            -- Visual feedback
            TrackButton.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
            TrackStroke.Color = Color3.fromRGB(100, 150, 255)
            TrackStroke.Transparency = 0
            
            task.wait(0.2)
            TrackButton.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
            TrackStroke.Color = Color3.fromRGB(60, 60, 90)
            TrackStroke.Transparency = 0.7
        end)
        
        -- Hover effect
        TrackButton.MouseEnter:Connect(function()
            TweenService:Create(TrackButton, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(45, 45, 65)
            }):Play()
            TweenService:Create(TrackStroke, TweenInfo.new(0.2), {
                Transparency = 0.3
            }):Play()
        end)
        
        TrackButton.MouseLeave:Connect(function()
            TweenService:Create(TrackButton, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(30, 30, 45)
            }):Play()
            TweenService:Create(TrackStroke, TweenInfo.new(0.2), {
                Transparency = 0.7
            }):Play()
        end)
        
        -- Delete button for each track
        local DeleteButton = Instance.new("TextButton")
        DeleteButton.Size = UDim2.new(0, 35, 0, 35)
        DeleteButton.Position = UDim2.new(1, -40, 0.5, -17)
        DeleteButton.BackgroundColor3 = Color3.fromRGB(150, 40, 40)
        DeleteButton.BorderSizePixel = 0
        DeleteButton.Text = "üóëÔ∏è"
        DeleteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        DeleteButton.Font = Enum.Font.GothamBold
        DeleteButton.TextSize = 16
        DeleteButton.Parent = TrackButton
        
        local DeleteCorner = Instance.new("UICorner")
        DeleteCorner.CornerRadius = UDim.new(0, 6)
        DeleteCorner.Parent = DeleteButton
        
        DeleteButton.MouseButton1Click:Connect(function()
            table.remove(MusicTracks, trackIndex)
            SaveMusicConfig()
            RefreshMusicList()
            if Settings.SoundFXEnabled then
                ClickSound:Play()
            end
        end)
        
        DeleteButton.MouseEnter:Connect(function()
            TweenService:Create(DeleteButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(200, 50, 50)}):Play()
        end)
        
        DeleteButton.MouseLeave:Connect(function()
            TweenService:Create(DeleteButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(150, 40, 40)}):Play()
        end)
    end
end

--// Add Music UI Section
-- Song Name Input (no label)
local NameInput = Instance.new("TextBox")
NameInput.Size = UDim2.new(1, 0, 0, 40)
NameInput.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
NameInput.BorderSizePixel = 0
NameInput.Text = ""
NameInput.PlaceholderText = "Enter song name..."
NameInput.TextColor3 = Color3.fromRGB(255, 255, 255)
NameInput.PlaceholderColor3 = Color3.fromRGB(120, 120, 140)
NameInput.Font = Enum.Font.Gotham
NameInput.TextSize = 14
NameInput.ClearTextOnFocus = false
NameInput.Parent = MusicContent

Instance.new("UICorner", NameInput).CornerRadius = UDim.new(0, 8)

-- Asset ID Input (no label)
local IDInput = Instance.new("TextBox")
IDInput.Size = UDim2.new(1, 0, 0, 40)
IDInput.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
IDInput.BorderSizePixel = 0
IDInput.Text = ""
IDInput.PlaceholderText = "Enter asset ID (e.g., 1234567890)..."
IDInput.TextColor3 = Color3.fromRGB(255, 255, 255)
IDInput.PlaceholderColor3 = Color3.fromRGB(120, 120, 140)
IDInput.Font = Enum.Font.Gotham
IDInput.TextSize = 14
IDInput.ClearTextOnFocus = false
IDInput.Parent = MusicContent

Instance.new("UICorner", IDInput).CornerRadius = UDim.new(0, 8)

-- Add Track Button
local AddTrackButton = Instance.new("TextButton")
AddTrackButton.Size = UDim2.new(1, 0, 0, 45)
AddTrackButton.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
AddTrackButton.BorderSizePixel = 0
AddTrackButton.Text = "‚ûï Add Track"
AddTrackButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AddTrackButton.Font = Enum.Font.GothamBold
AddTrackButton.TextSize = 15
AddTrackButton.Parent = MusicContent

Instance.new("UICorner", AddTrackButton).CornerRadius = UDim.new(0, 8)

AddTrackButton.MouseButton1Click:Connect(function()
    local songName = NameInput.Text
    local assetID = IDInput.Text
    
    -- Validate inputs with visual feedback
    if songName == "" or assetID == "" then
        -- Show error by changing button color temporarily
        AddTrackButton.Text = "‚ö†Ô∏è PLEASE INPUT SONG NAME/ASSET ID"
        AddTrackButton.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
        task.wait(2)
        AddTrackButton.Text = "‚ûï Add Track"
        AddTrackButton.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
        -- Missing song data
        return
    end
    
    -- Format the asset ID
    local formattedID = "rbxassetid://" .. assetID:gsub("rbxassetid://", "")
    
    -- Add to music tracks with default genre
    table.insert(MusicTracks, {
        Name = songName,
        ID = formattedID,
        Genre = "Custom"
    })
    
    -- Save and refresh
    SaveMusicConfig()
    RefreshMusicList()
    
    -- Clear inputs
    NameInput.Text = ""
    IDInput.Text = ""
    
    -- Show success feedback
    AddTrackButton.Text = "‚úì TRACK ADDED!"
    AddTrackButton.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
    task.wait(1)
    AddTrackButton.Text = "‚ûï Add Track"
    AddTrackButton.BackgroundColor3 = Color3.fromRGB(60, 150, 60)
    
    -- Play sound
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
    
    -- Song added
end)

AddTrackButton.MouseEnter:Connect(function()
    TweenService:Create(AddTrackButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 180, 70)}):Play()
end)

AddTrackButton.MouseLeave:Connect(function()
    TweenService:Create(AddTrackButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 150, 60)}):Play()
end)

-- Divider
local DividerLabel = Instance.new("TextLabel")
DividerLabel.Size = UDim2.new(1, 0, 0, 30)
DividerLabel.BackgroundTransparency = 1
DividerLabel.Text = "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ Your Tracks ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
DividerLabel.TextColor3 = Color3.fromRGB(100, 100, 150)
DividerLabel.Font = Enum.Font.GothamBold
DividerLabel.TextSize = 12
DividerLabel.Parent = MusicContent

-- Initial music list creation
RefreshMusicList()
end -- End of IsPremium check for Music tab

--// ========== DANGER TAB CONTENT ==========

CreateSectionHeader("üóëÔ∏è DESTROY SCRIPT", DangerContent)

local KillScriptButton = Instance.new("TextButton")
KillScriptButton.Size = UDim2.new(1, 0, 0, 55)
KillScriptButton.BackgroundColor3 = Color3.fromRGB(150, 40, 40)
KillScriptButton.BorderSizePixel = 0
KillScriptButton.Text = "üóëÔ∏è KILL SCRIPT"
KillScriptButton.TextColor3 = Color3.fromRGB(255, 255, 255)
KillScriptButton.Font = Enum.Font.GothamBold
KillScriptButton.TextSize = 18
KillScriptButton.Parent = DangerContent

Instance.new("UICorner", KillScriptButton).CornerRadius = UDim.new(0, 10)

local KillScriptStroke = Instance.new("UIStroke")
KillScriptStroke.Color = Color3.fromRGB(255, 100, 100)
KillScriptStroke.Thickness = 3
KillScriptStroke.Parent = KillScriptButton

--// Confirmation Dialog
local ConfirmDialog = Instance.new("Frame")
ConfirmDialog.Name = "ConfirmDialog"
ConfirmDialog.Size = UDim2.new(0, 350, 0, 200)
ConfirmDialog.Position = UDim2.new(0.5, -175, 0.5, -100)
ConfirmDialog.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
ConfirmDialog.BorderSizePixel = 0
ConfirmDialog.Visible = false
ConfirmDialog.ZIndex = 200
ConfirmDialog.Parent = ScreenGui

local ConfirmCorner = Instance.new("UICorner")
ConfirmCorner.CornerRadius = UDim.new(0, 15)
ConfirmCorner.Parent = ConfirmDialog

local ConfirmStroke = Instance.new("UIStroke")
ConfirmStroke.Color = Color3.fromRGB(255, 100, 100)
ConfirmStroke.Thickness = 4
ConfirmStroke.Parent = ConfirmDialog

local ConfirmTitle = Instance.new("TextLabel")
ConfirmTitle.Size = UDim2.new(1, 0, 0, 50)
ConfirmTitle.BackgroundTransparency = 1
ConfirmTitle.Text = "‚ö†Ô∏è ARE YOU SURE?"
ConfirmTitle.TextColor3 = Color3.fromRGB(255, 200, 0)
ConfirmTitle.Font = Enum.Font.GothamBold
ConfirmTitle.TextSize = 20
ConfirmTitle.Parent = ConfirmDialog

local ConfirmMessage = Instance.new("TextLabel")
ConfirmMessage.Size = UDim2.new(1, -40, 0, 60)
ConfirmMessage.Position = UDim2.new(0, 20, 0, 60)
ConfirmMessage.BackgroundTransparency = 1
ConfirmMessage.Text = "This will permanently close the UI and stop all features. You'll need to re-execute the script."
ConfirmMessage.TextColor3 = Color3.fromRGB(200, 200, 200)
ConfirmMessage.Font = Enum.Font.Gotham
ConfirmMessage.TextSize = 13
ConfirmMessage.TextWrapped = true
ConfirmMessage.TextXAlignment = Enum.TextXAlignment.Center
ConfirmMessage.Parent = ConfirmDialog

local ConfirmYesButton = Instance.new("TextButton")
ConfirmYesButton.Size = UDim2.new(0.45, 0, 0, 50)
ConfirmYesButton.Position = UDim2.new(0.05, 0, 1, -60)
ConfirmYesButton.BackgroundColor3 = Color3.fromRGB(180, 40, 40)
ConfirmYesButton.BorderSizePixel = 0
ConfirmYesButton.Text = "‚úì YES, KILL IT"
ConfirmYesButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ConfirmYesButton.Font = Enum.Font.GothamBold
ConfirmYesButton.TextSize = 15
ConfirmYesButton.Parent = ConfirmDialog

local ConfirmYesCorner = Instance.new("UICorner")
ConfirmYesCorner.CornerRadius = UDim.new(0, 10)
ConfirmYesCorner.Parent = ConfirmYesButton

local ConfirmNoButton = Instance.new("TextButton")
ConfirmNoButton.Size = UDim2.new(0.45, 0, 0, 50)
ConfirmNoButton.Position = UDim2.new(0.5, 0, 1, -60)
ConfirmNoButton.BackgroundColor3 = Color3.fromRGB(40, 120, 60)
ConfirmNoButton.BorderSizePixel = 0
ConfirmNoButton.Text = "‚úï CANCEL"
ConfirmNoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ConfirmNoButton.Font = Enum.Font.GothamBold
ConfirmNoButton.TextSize = 15
ConfirmNoButton.Parent = ConfirmDialog

local ConfirmNoCorner = Instance.new("UICorner")
ConfirmNoCorner.CornerRadius = UDim.new(0, 10)
ConfirmNoCorner.Parent = ConfirmNoButton

--// Rank System based on Current ELO value (Exact Roblox Rivals Tiers)
local function GetRankFromELO(rankValue)
    -- If rankValue is a string, return it directly
    if type(rankValue) == "string" then
        return rankValue
    end
    
    -- Otherwise, use ELO-based ranking (if they use numeric values)
    local elo = tonumber(rankValue) or 0
    
    -- Top tier ranks with correct thresholds
    if elo >= 11300 then
        return "Archnemesis", true -- Return rank and leaderboard status
    elseif elo >= 9200 then
        return "Nemesis", true -- On leaderboard (9200-11299)
    elseif elo >= 3400 then
        return "Onyx III", false
    elseif elo >= 3200 then
        return "Onyx II", false
    elseif elo >= 3000 then
        return "Onyx I", false
    elseif elo >= 2800 then
        return "Diamond III", false
    elseif elo >= 2600 then
        return "Diamond II", false
    elseif elo >= 2400 then
        return "Diamond I", false
    elseif elo >= 2200 then
        return "Platinum III", false
    elseif elo >= 2000 then
        return "Platinum II", false
    elseif elo >= 1800 then
        return "Platinum I", false
    elseif elo >= 1600 then
        return "Gold III", false
    elseif elo >= 1400 then
        return "Gold II", false
    elseif elo >= 1200 then
        return "Gold I", false
    elseif elo >= 1000 then
        return "Silver III", false
    elseif elo >= 800 then
        return "Silver II", false
    elseif elo >= 600 then
        return "Silver I", false
    elseif elo >= 400 then
        return "Bronze III", false
    elseif elo >= 200 then
        return "Bronze II", false
    elseif elo >= 0 then
        return "Bronze I", false
    else
        return "Unranked", false
    end
end

--// Get rank image based on tier
local function GetRankImage(rankName)
    if rankName:find("Archnemesis") then
        return "rbxassetid://84042201632531"
    elseif rankName:find("Nemesis") then
        return "rbxassetid://85372690624082"
    elseif rankName:find("Onyx") then
        return "rbxassetid://81988831298898"
    elseif rankName:find("Diamond") then
        return "rbxassetid://125428823854925"
    elseif rankName:find("Platinum") then
        return "rbxassetid://113781288054455"
    elseif rankName:find("Gold") then
        return "rbxassetid://130661359518700"
    elseif rankName:find("Silver") then
        return "rbxassetid://89679253516530"
    elseif rankName:find("Bronze") then
        return "rbxassetid://127062731651005"
    else
        return "rbxassetid://80300644356908" -- Unranked image
    end
end

--// Get rank color based on tier
local function GetRankColor(rankName)
    if rankName:find("Archnemesis") then
        return Color3.fromRGB(255, 50, 255), Color3.fromRGB(200, 0, 255)
    elseif rankName:find("Nemesis") then
        return Color3.fromRGB(255, 0, 150), Color3.fromRGB(200, 0, 100)
    elseif rankName:find("Onyx") then
        return Color3.fromRGB(180, 180, 220), Color3.fromRGB(120, 120, 180)
    elseif rankName:find("Diamond") then
        return Color3.fromRGB(100, 200, 255), Color3.fromRGB(50, 150, 255)
    elseif rankName:find("Platinum") then
        return Color3.fromRGB(100, 255, 200), Color3.fromRGB(50, 200, 150)
    elseif rankName:find("Gold") then
        return Color3.fromRGB(255, 215, 0), Color3.fromRGB(200, 170, 0)
    elseif rankName:find("Silver") then
        return Color3.fromRGB(192, 192, 192), Color3.fromRGB(140, 140, 140)
    elseif rankName:find("Bronze") then
        return Color3.fromRGB(205, 127, 50), Color3.fromRGB(160, 90, 30)
    else
        return Color3.fromRGB(150, 150, 150), Color3.fromRGB(100, 100, 100)
    end
end

--// Function to create a player card
local function CreatePlayerCard(player)
    --// Main Frame (starts small and transparent)
    local PlayerFrame = Instance.new("Frame")
    PlayerFrame.Name = "PlayerCard_" .. player.Name
    PlayerFrame.Size = UDim2.new(1, -20, 0, 0)
    PlayerFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    PlayerFrame.BorderSizePixel = 0
    PlayerFrame.BackgroundTransparency = 1
    PlayerFrame.Parent = MainContainer

    local FrameCorner = Instance.new("UICorner")
    FrameCorner.CornerRadius = UDim.new(0, 12)
    FrameCorner.Parent = PlayerFrame

    local FrameStroke = Instance.new("UIStroke")
    FrameStroke.Color = Color3.fromRGB(100, 100, 150)
    FrameStroke.Thickness = 2
    FrameStroke.Transparency = 1
    FrameStroke.Parent = PlayerFrame

    local FrameGradient = Instance.new("UIGradient")
    FrameGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 45)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30))
    }
    FrameGradient.Rotation = 135
    FrameGradient.Parent = PlayerFrame

    --// Avatar Container (with glow effect)
    local AvatarContainer = Instance.new("Frame")
    AvatarContainer.Name = "AvatarContainer"
    AvatarContainer.Size = UDim2.new(0, 0, 0, 0)
    AvatarContainer.Position = UDim2.new(0, 60, 0, 70)
    AvatarContainer.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    AvatarContainer.BorderSizePixel = 0
    AvatarContainer.BackgroundTransparency = 1
    AvatarContainer.Parent = PlayerFrame

    local AvatarContainerCorner = Instance.new("UICorner")
    AvatarContainerCorner.CornerRadius = UDim.new(0, 10)
    AvatarContainerCorner.Parent = AvatarContainer

    local AvatarGlow = Instance.new("UIStroke")
    AvatarGlow.Color = Color3.fromRGB(100, 150, 255)
    AvatarGlow.Thickness = 3
    AvatarGlow.Transparency = 1
    AvatarGlow.Parent = AvatarContainer

    --// Avatar Image
    local AvatarImage = Instance.new("ImageLabel")
    AvatarImage.Name = "AvatarImage"
    AvatarImage.Size = UDim2.new(1, -6, 1, -6)
    AvatarImage.Position = UDim2.new(0, 3, 0, 3)
    AvatarImage.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    AvatarImage.BorderSizePixel = 0
    AvatarImage.ImageTransparency = 1
    AvatarImage.Parent = AvatarContainer

    local AvatarCorner = Instance.new("UICorner")
    AvatarCorner.CornerRadius = UDim.new(0, 8)
    AvatarCorner.Parent = AvatarImage

    -- Load Player Avatar
    task.spawn(function()
        pcall(function()
            local content = Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
            AvatarImage.Image = content
        end)
    end)

    --// Info Container
    local InfoContainer = Instance.new("Frame")
    InfoContainer.Name = "InfoContainer"
    InfoContainer.Size = UDim2.new(0, 230, 0, 110)
    InfoContainer.Position = UDim2.new(0, 125, 0, 15)
    InfoContainer.BackgroundTransparency = 1
    InfoContainer.Parent = PlayerFrame

    --// Player Name Label (with shadow effect) - starts invisible
    local NameShadow = Instance.new("TextLabel")
    NameShadow.Name = "NameShadow"
    NameShadow.Size = UDim2.new(1, 0, 0, 24)
    NameShadow.Position = UDim2.new(0, 2, 0, 2)
    NameShadow.BackgroundTransparency = 1
    NameShadow.Text = player.DisplayName
    NameShadow.TextColor3 = Color3.fromRGB(0, 0, 0)
    NameShadow.Font = Enum.Font.GothamBold
    NameShadow.TextSize = 16
    NameShadow.TextXAlignment = Enum.TextXAlignment.Left
    NameShadow.TextTruncate = Enum.TextTruncate.AtEnd
    NameShadow.TextTransparency = 1
    NameShadow.Parent = InfoContainer

    local NameLabel = Instance.new("TextLabel")
    NameLabel.Name = "NameLabel"
    NameLabel.Size = UDim2.new(1, 0, 0, 24)
    NameLabel.Position = UDim2.new(0, 0, 0, 0)
    NameLabel.BackgroundTransparency = 1
    NameLabel.Text = player.DisplayName
    NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    NameLabel.Font = Enum.Font.GothamBold
    NameLabel.TextSize = 16
    NameLabel.TextXAlignment = Enum.TextXAlignment.Left
    NameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    NameLabel.TextTransparency = 1
    NameLabel.Parent = InfoContainer

    --// Stats Container with background - starts invisible
    local StatsContainer = Instance.new("Frame")
    StatsContainer.Name = "StatsContainer"
    StatsContainer.Size = UDim2.new(1, -4, 0, 95)
    StatsContainer.AutomaticSize = Enum.AutomaticSize.None
    StatsContainer.Position = UDim2.new(0, 0, 0, 30)
    StatsContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    StatsContainer.BackgroundTransparency = 1
    StatsContainer.BorderSizePixel = 0
    StatsContainer.Parent = InfoContainer

    local StatsCorner = Instance.new("UICorner")
    StatsCorner.CornerRadius = UDim.new(0, 8)
    StatsCorner.Parent = StatsContainer

    --// Level Icon - starts invisible
    local LevelIcon = Instance.new("ImageLabel")
    LevelIcon.Name = "LevelIcon"
    LevelIcon.Size = UDim2.new(0, 36, 0, 34)
    LevelIcon.Position = UDim2.new(0, 8, 0, -3)
    LevelIcon.BackgroundTransparency = 1
    LevelIcon.Image = "rbxassetid://98359327556329"
    LevelIcon.ImageColor3 = Color3.fromRGB(100, 200, 255)
    LevelIcon.ImageTransparency = 1
    LevelIcon.ScaleType = Enum.ScaleType.Fit
    LevelIcon.Parent = StatsContainer

    --// Level Label
    local LevelLabel = Instance.new("TextLabel")
    LevelLabel.Name = "LevelLabel"
    LevelLabel.Size = UDim2.new(1, -35, 0, 18)
    LevelLabel.Position = UDim2.new(0, 42, 0, 5)
    LevelLabel.BackgroundTransparency = 1
    LevelLabel.Text = "Level: Loading..."
    LevelLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
    LevelLabel.Font = Enum.Font.GothamBold
    LevelLabel.TextSize = 13
    LevelLabel.TextXAlignment = Enum.TextXAlignment.Left
    LevelLabel.TextTransparency = 1
    LevelLabel.Parent = StatsContainer

    --// Win Streak Icon
    local WinStreakIcon = Instance.new("TextLabel")
    WinStreakIcon.Name = "WinStreakIcon"
    WinStreakIcon.Size = UDim2.new(0, 28, 0, 26)
    WinStreakIcon.Position = UDim2.new(0, 8, 0, 28)
    WinStreakIcon.BackgroundTransparency = 1
    WinStreakIcon.Text = "üî•"
    WinStreakIcon.TextColor3 = Color3.fromRGB(255, 180, 0)
    WinStreakIcon.Font = Enum.Font.Gotham
    WinStreakIcon.TextSize = 18
    WinStreakIcon.TextTransparency = 1
    WinStreakIcon.Parent = StatsContainer

    --// Win Streak Label
    local WinStreakLabel = Instance.new("TextLabel")
    WinStreakLabel.Name = "WinStreakLabel"
    WinStreakLabel.Size = UDim2.new(1, -35, 0, 18)
    WinStreakLabel.Position = UDim2.new(0, 42, 0, 32)
    WinStreakLabel.BackgroundTransparency = 1
    WinStreakLabel.Text = "Streak: Loading..."
    WinStreakLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
    WinStreakLabel.Font = Enum.Font.GothamBold
    WinStreakLabel.TextSize = 13
    WinStreakLabel.TextXAlignment = Enum.TextXAlignment.Left
    WinStreakLabel.TextTransparency = 1
    WinStreakLabel.Parent = StatsContainer

    --// ELO Icon
    local EloIcon = Instance.new("TextLabel")
    EloIcon.Name = "EloIcon"
    EloIcon.Size = UDim2.new(0, 28, 0, 26)
    EloIcon.Position = UDim2.new(0, 8, 0, 51)
    EloIcon.BackgroundTransparency = 1
    EloIcon.Text = "‚ö°"
    EloIcon.TextColor3 = Color3.fromRGB(255, 200, 100)
    EloIcon.Font = Enum.Font.Gotham
    EloIcon.TextSize = 18
    EloIcon.TextTransparency = 0
    EloIcon.ZIndex = 10
    EloIcon.Visible = true
    EloIcon.Parent = StatsContainer

    --// ELO Label
    local EloLabel = Instance.new("TextLabel")
    EloLabel.Name = "EloLabel"
    EloLabel.Size = UDim2.new(1, -35, 0, 18)
    EloLabel.Position = UDim2.new(0, 42, 0, 55)
    EloLabel.BackgroundTransparency = 1
    EloLabel.Text = "ELO: 0"
    EloLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
    EloLabel.Font = Enum.Font.GothamBold
    EloLabel.TextSize = 13
    EloLabel.TextXAlignment = Enum.TextXAlignment.Left
    EloLabel.TextTransparency = 0
    EloLabel.ZIndex = 10
    EloLabel.Visible = true
    EloLabel.Parent = StatsContainer

    --// Rank Container with dynamic background - starts invisible
    local RankContainer = Instance.new("Frame")
    RankContainer.Name = "RankContainer"
    RankContainer.Size = UDim2.new(1, -16, 0, 20)
    RankContainer.Position = UDim2.new(0, 8, 0, 69)
    RankContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    RankContainer.BorderSizePixel = 0
    RankContainer.BackgroundTransparency = 1
    RankContainer.Parent = StatsContainer

    local RankCorner = Instance.new("UICorner")
    RankCorner.CornerRadius = UDim.new(0, 6)
    RankCorner.Parent = RankContainer

    local RankGradient = Instance.new("UIGradient")
    RankGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 50, 70)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 50))
    }
    RankGradient.Rotation = 90
    RankGradient.Parent = RankContainer

    --// Rank Image - starts invisible
    local RankImage = Instance.new("ImageLabel")
    RankImage.Name = "RankImage"
    RankImage.Size = UDim2.new(0, 20, 0, 20)
    RankImage.Position = UDim2.new(0, 8, 0, 2)
    RankImage.BackgroundTransparency = 1
    RankImage.ScaleType = Enum.ScaleType.Fit
    RankImage.ImageTransparency = 1
    RankImage.Parent = RankContainer

    --// Rank Label
    local RankLabel = Instance.new("TextLabel")
    RankLabel.Name = "RankLabel"
    RankLabel.Size = UDim2.new(1, -35, 0, 24)
    RankLabel.Position = UDim2.new(0, 32, 0, 0)
    RankLabel.BackgroundTransparency = 1
    RankLabel.Text = "Loading..."
    RankLabel.TextColor3 = Color3.fromRGB(255, 150, 255)
    RankLabel.Font = Enum.Font.GothamBold
    RankLabel.TextSize = 13
    RankLabel.TextXAlignment = Enum.TextXAlignment.Left
    RankLabel.TextTruncate = Enum.TextTruncate.AtEnd
    RankLabel.TextTransparency = 1
    RankLabel.Parent = RankContainer
    
    --// Leaderboard Badge (appears for 9200+ ELO players)
    local LeaderboardBadge = Instance.new("Frame")
    LeaderboardBadge.Name = "LeaderboardBadge"
    LeaderboardBadge.Size = UDim2.new(1, -8, 0, 20)
    LeaderboardBadge.Position = UDim2.new(0, 4, 1, 5)
    LeaderboardBadge.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
    LeaderboardBadge.BorderSizePixel = 0
    LeaderboardBadge.Visible = false
    LeaderboardBadge.Parent = InfoContainer
    
    local BadgeCorner = Instance.new("UICorner")
    BadgeCorner.CornerRadius = UDim.new(0, 6)
    BadgeCorner.Parent = LeaderboardBadge
    
    local BadgeStroke = Instance.new("UIStroke")
    BadgeStroke.Color = Color3.fromRGB(255, 255, 100)
    BadgeStroke.Thickness = 2
    BadgeStroke.Parent = LeaderboardBadge
    
    local BadgeLabel = Instance.new("TextLabel")
    BadgeLabel.Name = "BadgeLabel"
    BadgeLabel.Size = UDim2.new(1, 0, 1, 0)
    BadgeLabel.BackgroundTransparency = 1
    BadgeLabel.Text = "üèÜ ON LEADERBOARD üèÜ"
    BadgeLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
    BadgeLabel.Font = Enum.Font.GothamBold
    BadgeLabel.TextSize = 11
    BadgeLabel.TextXAlignment = Enum.TextXAlignment.Center
    BadgeLabel.Parent = LeaderboardBadge
    
    local BadgeGradient = Instance.new("UIGradient")
    BadgeGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 215, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 255, 100)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 215, 0))
    }
    BadgeGradient.Parent = LeaderboardBadge

    --// Store references
    local cardData = {
        Frame = PlayerFrame,
        LevelLabel = LevelLabel,
        WinStreakLabel = WinStreakLabel,
        EloLabel = EloLabel,
        EloIcon = EloIcon,
        RankLabel = RankLabel,
        RankImage = RankImage,
        RankContainer = RankContainer,
        RankGradient = RankGradient,
        FrameStroke = FrameStroke,
        AvatarGlow = AvatarGlow,
        AvatarContainer = AvatarContainer,
        AvatarImage = AvatarImage,
        NameLabel = NameLabel,
        NameShadow = NameShadow,
        StatsContainer = StatsContainer,
        LevelIcon = LevelIcon,
        WinStreakIcon = WinStreakIcon,
        LeaderboardBadge = LeaderboardBadge,
        Player = player
    }

    -- EPIC ENTRANCE ANIMATION SEQUENCE (OPTIMIZED FOR MANY PLAYERS)
    task.spawn(function()
        -- Calculate speed multiplier based on player count (SUPER FAST with many players!)
        local playerCount = #Players:GetPlayers() - 1 -- Exclude local player
        local speedMultiplier = 1
        
        if playerCount > 20 then
            speedMultiplier = 10 -- 10x faster for 20+ players (0.05s per card)
        elseif playerCount > 10 then
            speedMultiplier = 5 -- 5x faster for 10-20 players (0.1s per card)
        elseif playerCount > 5 then
            speedMultiplier = 2.5 -- 2.5x faster for 5-10 players
        end
        
        -- Adjust all timing
        local baseWait = 0.05 / speedMultiplier
        local animSpeed = math.max(0.15, 0.5 / speedMultiplier)
        
        task.wait(baseWait)
        
        -- Play card load sound only for fewer players
        if CardLoadSound and playerCount <= 10 then
            CardLoadSound:Play()
        end
        
        -- Step 1: Expand the card frame with bounce effect
        TweenService:Create(PlayerFrame, TweenInfo.new(animSpeed, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(1, -20, 0, 140),
            BackgroundTransparency = 0
        }):Play()
        
        TweenService:Create(FrameStroke, TweenInfo.new(animSpeed, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Transparency = 0.5
        }):Play()
        
        task.wait(math.max(0.02, 0.15 / speedMultiplier))
        
        -- Step 2: Avatar pops in from center with rotation + SPARKLES
        AvatarContainer.Rotation = -180
        
        -- Create sparkle particles around avatar
        local function CreateSparkle(parent, color)
            local sparkle = Instance.new("Frame")
            sparkle.Size = UDim2.new(0, 4, 0, 4)
            sparkle.Position = UDim2.new(0.5, 0, 0.5, 0)
            sparkle.AnchorPoint = Vector2.new(0.5, 0.5)
            sparkle.BackgroundColor3 = color
            sparkle.BorderSizePixel = 0
            sparkle.ZIndex = 10
            sparkle.Parent = parent
            
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(1, 0)
            corner.Parent = sparkle
            
            -- Random direction
            local angle = math.rad(math.random(0, 360))
            local distance = math.random(40, 70)
            local endX = math.cos(angle) * distance
            local endY = math.sin(angle) * distance
            
            -- Animate outward and fade
            TweenService:Create(sparkle, TweenInfo.new(0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Position = UDim2.new(0.5, endX, 0.5, endY),
                BackgroundTransparency = 1,
                Size = UDim2.new(0, 0, 0, 0)
            }):Play()
            
            task.delay(0.6, function()
                sparkle:Destroy()
            end)
        end
        
        -- Spawn sparkles only for fewer players
        local sparkleCount = playerCount > 15 and 0 or (playerCount > 10 and 2 or 8)
        for i = 1, sparkleCount do
            if playerCount <= 10 then
                task.spawn(function()
                    local colors = {
                        Color3.fromRGB(100, 200, 255),
                        Color3.fromRGB(150, 150, 255),
                        Color3.fromRGB(255, 255, 255),
                        Color3.fromRGB(200, 150, 255)
                    }
                    CreateSparkle(AvatarContainer, colors[math.random(1, #colors)])
                end)
                task.wait(0.01 / speedMultiplier)
            end
        end
        
        -- Play sparkle sound only for fewer players
        if SparkleSound and playerCount <= 10 then
            SparkleSound:Play()
        end
        
        local avatarSpeed = math.max(0.2, 0.6 / speedMultiplier)
        TweenService:Create(AvatarContainer, TweenInfo.new(avatarSpeed, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 100, 0, 100),
            Position = UDim2.new(0, 15, 0, 20),
            BackgroundTransparency = 0,
            Rotation = 0
        }):Play()
        
        TweenService:Create(AvatarGlow, TweenInfo.new(avatarSpeed, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Transparency = 0.6
        }):Play()
        
        task.wait(baseWait)
        
        TweenService:Create(AvatarImage, TweenInfo.new(animSpeed * 0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            ImageTransparency = 0
        }):Play()
        
        task.wait(baseWait * 1.5)
        
        -- Step 3: Name slides in from right
        NameLabel.Position = UDim2.new(0, 50, 0, 0)
        NameShadow.Position = UDim2.new(0, 52, 0, 2)
        
        TweenService:Create(NameLabel, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = UDim2.new(0, 0, 0, 0),
            TextTransparency = 0
        }):Play()
        
        TweenService:Create(NameShadow, TweenInfo.new(animSpeed * 0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = UDim2.new(0, 2, 0, 2),
            TextTransparency = 0.5
        }):Play()
        
        task.wait(baseWait)
        
        -- Step 4: Stats container fades in
        TweenService:Create(StatsContainer, TweenInfo.new(animSpeed * 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundTransparency = 0.5
        }):Play()
        
        task.wait(baseWait * 0.5)
        
        -- Step 5: Level stat appears with scale effect
        LevelIcon.Size = UDim2.new(0, 18, 0, 17)
        LevelLabel.TextSize = 8
        
        TweenService:Create(LevelIcon, TweenInfo.new(animSpeed * 0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            ImageTransparency = 0,
            Size = UDim2.new(0, 36, 0, 34)
        }):Play()
        
        TweenService:Create(LevelLabel, TweenInfo.new(animSpeed * 0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            TextTransparency = 0,
            TextSize = 13
        }):Play()
        
        task.wait(baseWait * 0.4)
        
        -- Step 6: Win streak appears
        WinStreakIcon.TextSize = 10
        WinStreakLabel.TextSize = 8
        
        TweenService:Create(WinStreakIcon, TweenInfo.new(animSpeed * 0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            TextTransparency = 0,
            TextSize = 18
        }):Play()
        
        TweenService:Create(WinStreakLabel, TweenInfo.new(animSpeed * 0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            TextTransparency = 0,
            TextSize = 13
        }):Play()
        
        task.wait(baseWait * 0.4)
        
        -- Step 7: Rank container slides up from bottom + SPARKLES
        RankContainer.Position = UDim2.new(0, 0, 0, 104)
        
        -- Play sparkle sound only for fewer players
        if SparkleSound and playerCount <= 10 then
            SparkleSound.PlaybackSpeed = 2.5
            SparkleSound:Play()
            task.wait(0.02 / speedMultiplier)
            SparkleSound.PlaybackSpeed = 2.0
        end
        
        -- Create sparkles around rank (fewer for many players)
        local rankSparkles = playerCount > 15 and 0 or (playerCount > 10 and 1 or 5)
        for i = 1, rankSparkles do
            task.spawn(function()
                local sparkle = Instance.new("Frame")
                sparkle.Size = UDim2.new(0, 3, 0, 3)
                sparkle.Position = UDim2.new(math.random(0, 100) / 100, 0, 0, 0)
                sparkle.AnchorPoint = Vector2.new(0.5, 0.5)
                sparkle.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
                sparkle.BorderSizePixel = 0
                sparkle.ZIndex = 10
                sparkle.Parent = RankContainer
                
                local corner = Instance.new("UICorner")
                corner.CornerRadius = UDim.new(1, 0)
                corner.Parent = sparkle
                
                local sparkleSpeed = math.max(0.2, 0.5 / speedMultiplier)
                TweenService:Create(sparkle, TweenInfo.new(sparkleSpeed, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    Position = UDim2.new(sparkle.Position.X.Scale, 0, 1, 10),
                    BackgroundTransparency = 1,
                    Size = UDim2.new(0, 0, 0, 0)
                }):Play()
                
                task.delay(sparkleSpeed, function()
                    sparkle:Destroy()
                end)
            end)
            task.wait(0.01 / speedMultiplier)
        end
        
        TweenService:Create(RankContainer, TweenInfo.new(animSpeed * 0.8, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Position = UDim2.new(0, 0, 0, 69),
            BackgroundTransparency = 0
        }):Play()
        
        task.wait(baseWait * 0.5)
        
        -- Step 8: Rank image and label fade in
        TweenService:Create(RankImage, TweenInfo.new(animSpeed * 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            ImageTransparency = 0
        }):Play()
        
        TweenService:Create(RankLabel, TweenInfo.new(animSpeed * 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            TextTransparency = 0
        }):Play()
        
        -- Play a subtle pop sound only for fewer players
        if playerCount <= 10 then
            task.wait(baseWait * 0.5)
            if ClickSound then
                ClickSound.Volume = 0.15
                ClickSound.PlaybackSpeed = 1.5
                ClickSound:Play()
                task.wait(baseWait * 0.5)
                ClickSound.Volume = 0.3
                ClickSound.PlaybackSpeed = 1.0
            end
        end
    end)

    return cardData
end

--// Function to Update Player Info (with error protection)
local function UpdatePlayerInfo(cardData)
    -- Wrap entire function in pcall to prevent crashes that cause kicks
    local success, err = pcall(function()
        local player = cardData.Player
        
        -- Check if player still exists
        if not player or not player.Parent then
            return
        end
    
    -- Check if CustomLeaderstats exists
    if player:FindFirstChild("CustomLeaderstats") then
        local customStats = player.CustomLeaderstats
        
        -- Update Level
        if customStats:FindFirstChild("Level") then
            local levelObj = customStats.Level
            local level = levelObj.Value
            cardData.LevelLabel.Text = "Level " .. tostring(level)
        else
            cardData.LevelLabel.Text = "Level: N/A"
        end
        
        -- Update Win Streak
        if customStats:FindFirstChild("Win Streak") then
            local winStreakObj = customStats["Win Streak"]
            local winStreak = winStreakObj.Value
            cardData.WinStreakLabel.Text = "Streak: " .. tostring(winStreak)
        else
            cardData.WinStreakLabel.Text = "Streak: N/A"
        end
        
        -- Update Rank (Current ELO)
        if customStats:FindFirstChild("Current ELO") then
            local eloObj = customStats["Current ELO"]
            local rankValue = eloObj.Value
            local rankName, isOnLeaderboard = GetRankFromELO(rankValue)
            
            -- Update ELO display
            if cardData.EloLabel and cardData.EloIcon then
                if IsPremium then
                    local eloValue = tonumber(rankValue) or 0
                    -- Display -1 as 0
                    if eloValue < 0 then
                        eloValue = 0
                    end
                    cardData.EloLabel.Text = "ELO: " .. tostring(eloValue)
                    cardData.EloLabel.TextTransparency = 0
                    cardData.EloIcon.TextTransparency = 0
                    -- ELO updated
                else
                    -- Free tier - show Premium Feature
                    cardData.EloLabel.Text = "ELO: Premium Feature"
                    cardData.EloLabel.TextTransparency = 0
                    cardData.EloIcon.TextTransparency = 0
                end
            end
            
            -- Get rank colors and image
            local primaryColor, secondaryColor = GetRankColor(rankName)
            local rankImageId = GetRankImage(rankName)
            
            -- Update rank label and colors
            cardData.RankLabel.Text = rankName
            cardData.RankLabel.TextColor3 = primaryColor
            
            -- Update rank image
            cardData.RankImage.Image = rankImageId
            
            -- Show/hide leaderboard badge for 9200+ ELO players
            if isOnLeaderboard then
                cardData.LeaderboardBadge.Visible = true
                -- Animate badge appearance if it just became visible
                if cardData.LeaderboardBadge.BackgroundTransparency == 1 then
                    cardData.LeaderboardBadge.BackgroundTransparency = 1
                    TweenService:Create(cardData.LeaderboardBadge, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                        BackgroundTransparency = 0
                    }):Play()
                end
            else
                cardData.LeaderboardBadge.Visible = false
            end
            
            -- Update rank container gradient with rank colors
            cardData.RankGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, primaryColor),
                ColorSequenceKeypoint.new(1, secondaryColor)
            }
            
            -- Update card border color based on rank
            cardData.FrameStroke.Color = primaryColor
            
            -- Update avatar glow based on rank
            cardData.AvatarGlow.Color = primaryColor
            
            -- Try to load rank image from the Current ELO object
            if eloObj:IsA("ImageLabel") or eloObj:IsA("ImageButton") then
                cardData.RankImage.Image = eloObj.Image
            elseif eloObj:FindFirstChildWhichIsA("ImageLabel") then
                local imageObj = eloObj:FindFirstChildWhichIsA("ImageLabel")
                cardData.RankImage.Image = imageObj.Image
            elseif eloObj:FindFirstChildWhichIsA("ImageButton") then
                local imageObj = eloObj:FindFirstChildWhichIsA("ImageButton")
                cardData.RankImage.Image = imageObj.Image
            end
            
            -- Animate rank update
            TweenService:Create(cardData.RankContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                BackgroundColor3 = Color3.fromRGB(
                    math.clamp(primaryColor.R * 255 * 0.3, 0, 255),
                    math.clamp(primaryColor.G * 255 * 0.3, 0, 255),
                    math.clamp(primaryColor.B * 255 * 0.3, 0, 255)
                )
            }):Play()
        else
            cardData.RankLabel.Text = "Unranked"
            cardData.LeaderboardBadge.Visible = false
        end
    else
        cardData.LevelLabel.Text = "Level: ..."
        cardData.WinStreakLabel.Text = "Streak: ..."
        cardData.RankLabel.Text = "Loading..."
    end
    end) -- End of pcall
    
    if not success then
        -- Error updating player info
    end
end

--// Function to setup listeners for a player (with error protection)
local function SetupPlayerListeners(cardData)
    -- Wrap in pcall to prevent crashes
    pcall(function()
        local player = cardData.Player
        
        -- Wait for CustomLeaderstats
        local function onCustomLeaderstatsAdded(child)
            if child.Name == "CustomLeaderstats" then
                task.wait(0.5)
                UpdatePlayerInfo(cardData)
                
                -- Listen for stat changes
                for _, stat in pairs(child:GetChildren()) do
                    if stat:IsA("ValueBase") then
                        stat.Changed:Connect(function()
                            UpdatePlayerInfo(cardData)
                        end)
                    end
                end
                
                -- Listen for new stats being added
                child.ChildAdded:Connect(function(stat)
                    if stat:IsA("ValueBase") then
                        stat.Changed:Connect(function()
                            UpdatePlayerInfo(cardData)
                        end)
                    end
                    UpdatePlayerInfo(cardData)
                end)
            end
        end
        
        player.ChildAdded:Connect(onCustomLeaderstatsAdded)
        
        -- Check if CustomLeaderstats already exists
        if player:FindFirstChild("CustomLeaderstats") then
            onCustomLeaderstatsAdded(player.CustomLeaderstats)
        end
    end)
end

--// Function to update player count
local function UpdatePlayerCount()
    local count = 0
    for _ in pairs(PlayerCards) do
        count = count + 1
    end
    PlayerCountLabel.Text = tostring(count)
    
    -- Animate count update
    local originalSize = PlayerCountLabel.TextSize
    TweenService:Create(PlayerCountLabel, TweenInfo.new(0.2, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out), {
        TextSize = originalSize + 4
    }):Play()
    task.wait(0.2)
    TweenService:Create(PlayerCountLabel, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        TextSize = originalSize
    }):Play()
end

--// Function to add a player card
local function AddPlayer(player)
    -- Skip local player
    if player == LocalPlayer then
        return
    end
    
    -- Don't create duplicate cards
    if PlayerCards[player] then
        return
    end
    
    -- Create the card
    local cardData = CreatePlayerCard(player)
    PlayerCards[player] = cardData
    
    -- Setup listeners
    SetupPlayerListeners(cardData)
    
    -- Initial update
    UpdatePlayerInfo(cardData)
    
    -- Update player count
    UpdatePlayerCount()
    
    -- Auto-scroll to show the new card animation
    task.spawn(function()
        task.wait(0.1) -- Wait for card to start animating
        
        -- Calculate the position of the new card
        local cardPosition = cardData.Frame.AbsolutePosition.Y
        local containerPosition = MainContainer.AbsolutePosition.Y
        local containerSize = MainContainer.AbsoluteSize.Y
        
        -- Check if card is below visible area
        if cardPosition > containerPosition + containerSize - 150 then
            -- Smoothly scroll to show the new card
            local targetScroll = MainContainer.CanvasPosition.Y + 150
            TweenService:Create(MainContainer, TweenInfo.new(0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                CanvasPosition = Vector2.new(0, targetScroll)
            }):Play()
        end
    end)
end

--// Function to remove a player card
local function RemovePlayer(player)
    if PlayerCards[player] then
        local frame = PlayerCards[player].Frame
        
        -- Animate removal
        TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(1, -20, 0, 0),
            BackgroundTransparency = 1
        }):Play()
        
        task.wait(0.3)
        frame:Destroy()
        PlayerCards[player] = nil
        
        -- Update player count
        UpdatePlayerCount()
    end
end

--// Add existing players (with 5-second staggered loading for 20+ players)
local existingPlayers = {}
for _, player in pairs(Players:GetPlayers()) do
    table.insert(existingPlayers, player)
end

local totalPlayers = #existingPlayers

-- Check existing players for owners, mods and known players (only if mod detector is enabled)
if Settings.ModDetectorEnabled then
    for _, player in ipairs(existingPlayers) do
        -- Check owner list first (highest priority)
        if config.ownerList[player.UserId] then
            ShowModNotification(player.Name, player.UserId, "owner")
        -- Check mod watch list
        elseif config.modWatchList[player.UserId] then
            ShowModNotification(player.Name, player.UserId, "mod")
        -- Check known player watch list
        elseif config.knownWatchList[player.UserId] then
            ShowModNotification(player.Name, player.UserId, "player")
        end
        
        -- Scan existing player's friends (if enabled)
        if Settings.FriendScanEnabled then
            task.delay(math.random(5, 10), function() -- Longer randomized delay to spread out requests
                scanPlayerFriends(player)
            end)
        end
    end
end

-- If 20+ players, stagger loading over exactly 5 seconds
if totalPlayers > 20 then
    local delayPerPlayer = 5 / totalPlayers
    for i, player in ipairs(existingPlayers) do
        task.spawn(function()
            task.wait((i - 1) * delayPerPlayer)
            AddPlayer(player)
        end)
    end
else
    -- For 20 or fewer players, load instantly
    for _, player in ipairs(existingPlayers) do
        AddPlayer(player)
    end
end

--// Listen for new players
Players.PlayerAdded:Connect(function(player)
    -- Check if mod detector is enabled and if player is in watch lists
    if Settings.ModDetectorEnabled then
        -- Check owner list first (highest priority)
        if config.ownerList[player.UserId] then
            ShowModNotification(player.Name, player.UserId, "owner")
        -- Check mod watch list
        elseif config.modWatchList[player.UserId] then
            ShowModNotification(player.Name, player.UserId, "mod")
        -- Check known player watch list
        elseif config.knownWatchList[player.UserId] then
            ShowModNotification(player.Name, player.UserId, "player")
        end
    end
    
    -- Scan player's friends for mods/known players (if enabled)
    if Settings.FriendScanEnabled and Settings.ModDetectorEnabled then
        task.delay(5, function() -- Longer delay to avoid rate limits (mod.txt doesn't scan immediately)
            scanPlayerFriends(player)
        end)
    end
    
    -- Add player to UI
    AddPlayer(player)
end)

--// Listen for players leaving
Players.PlayerRemoving:Connect(RemovePlayer)

--// Collapse/Expand Functionality
local function ToggleCollapse()
    isCollapsed = not isCollapsed
    
    if isCollapsed then
        -- Play collapse sound
        if Settings.SoundFXEnabled then CollapseSound:Play() end
        
        print("[DEBUG] UI COLLAPSED - Setting MainContainer.Visible to false")
        
        -- Hide scrollbar and make container invisible
        MainContainer.ScrollBarThickness = 0
        MainContainer.Visible = false
        
        print("[DEBUG] MainContainer.Visible = " .. tostring(MainContainer.Visible))
        print("[DEBUG] UI minimized - Hiding custom cursor and restoring game mouse control")
        
        -- Hide custom cursor and let game control mouse when minimized
        CustomCursor.Visible = false
        
        -- Do NOT touch mouse settings - let game handle it naturally
        
        -- Collapse animation
        TweenService:Create(MainContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 400, 0, 0)
        }):Play()
        
        -- Rotate button
        TweenService:Create(CollapseButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Rotation = 180
        }):Play()
        
        CollapseButton.Text = "‚ñ≤"
    else
        -- Play expand sound
        if Settings.SoundFXEnabled then ExpandSound:Play() end
        
        print("[DEBUG] UI EXPANDED - Setting MainContainer.Visible to true")
        
        -- Expand animation
        TweenService:Create(MainContainer, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 400, 0, 650)
        }):Play()
        
        -- Show container and scrollbar after a delay
        task.wait(0.2)
        MainContainer.Visible = true
        
        print("[DEBUG] MainContainer.Visible = " .. tostring(MainContainer.Visible))
        print("[DEBUG] Mouse will be unlocked by the RenderStepped loop")
        
        -- Custom cursor will be shown again by the RenderStepped loop
        MainContainer.ScrollBarThickness = 8
        
        -- Rotate button back
        TweenService:Create(CollapseButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Rotation = 0
        }):Play()
        
        CollapseButton.Text = "‚ñº"
    end
end

-- Make sure button is clickable and use MouseButton1Down for better response
CollapseButton.MouseButton1Down:Connect(function()
    if Settings.SoundFXEnabled then ClickSound:Play() end
    ToggleCollapse()
end)

-- Hover effect for collapse button with glow
CollapseButton.MouseEnter:Connect(function()
    if Settings.SoundFXEnabled then HoverSound:Play() end
    TweenService:Create(CollapseButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundColor3 = Color3.fromRGB(70, 70, 110),
        TextSize = 20
    }):Play()
    TweenService:Create(CollapseButtonStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 0,
        Color = Color3.fromRGB(150, 150, 255)
    }):Play()
end)

CollapseButton.MouseLeave:Connect(function()
    TweenService:Create(CollapseButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundColor3 = Color3.fromRGB(40, 40, 60),
        TextSize = 18
    }):Play()
    TweenService:Create(CollapseButtonStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 0.5,
        Color = Color3.fromRGB(100, 100, 150)
    }):Play()
end)

-- Click effect for collapse button
CollapseButton.MouseButton1Down:Connect(function()
    TweenService:Create(CollapseButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 36, 0, 36)
    }):Play()
end)

CollapseButton.MouseButton1Up:Connect(function()
    TweenService:Create(CollapseButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 40, 0, 40)
    }):Play()
end)

--// Right Shift to toggle entire UI visibility
local isUIVisible = true

--// Tab Switching System - Enhanced with Animations
local function SwitchTab(tabName)
    -- Hide all content
    GeneralContent.Visible = false
    MusicContent.Visible = false
    ModDetectorContent.Visible = false
    KnownModsContent.Visible = false
    DangerContent.Visible = false
    
    -- Reset all tab colors and strokes
    GeneralTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
    GeneralTab.TextColor3 = Color3.fromRGB(180, 180, 200)
    GeneralTabStroke.Color = Color3.fromRGB(60, 60, 90)
    GeneralTabStroke.Thickness = 1.5
    GeneralTabStroke.Transparency = 0.7
    
    MusicTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
    MusicTab.TextColor3 = Color3.fromRGB(180, 180, 200)
    MusicTabStroke.Color = Color3.fromRGB(60, 60, 90)
    MusicTabStroke.Thickness = 1.5
    MusicTabStroke.Transparency = 0.7
    
    ModDetectorTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
    ModDetectorTab.TextColor3 = Color3.fromRGB(180, 180, 200)
    ModDetectorTabStroke.Color = Color3.fromRGB(60, 60, 90)
    ModDetectorTabStroke.Thickness = 1.5
    ModDetectorTabStroke.Transparency = 0.7
    
    KnownModsTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
    KnownModsTab.TextColor3 = Color3.fromRGB(180, 180, 200)
    KnownModsTabStroke.Color = Color3.fromRGB(60, 60, 90)
    KnownModsTabStroke.Thickness = 1.5
    KnownModsTabStroke.Transparency = 0.7
    
    DangerTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
    DangerTab.TextColor3 = Color3.fromRGB(180, 180, 200)
    DangerTabStroke.Color = Color3.fromRGB(60, 60, 90)
    DangerTabStroke.Thickness = 1.5
    DangerTabStroke.Transparency = 0.7
    
    -- Show selected tab and highlight button with enhanced style
    if tabName == "General" then
        GeneralContent.Visible = true
        GeneralTab.BackgroundColor3 = Color3.fromRGB(70, 110, 220)
        GeneralTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        GeneralTabStroke.Color = Color3.fromRGB(100, 150, 255)
        GeneralTabStroke.Thickness = 2
        GeneralTabStroke.Transparency = 0
    elseif tabName == "Music" then
        MusicContent.Visible = true
        MusicTab.BackgroundColor3 = Color3.fromRGB(70, 110, 220)
        MusicTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        MusicTabStroke.Color = Color3.fromRGB(100, 150, 255)
        MusicTabStroke.Thickness = 2
        MusicTabStroke.Transparency = 0
    elseif tabName == "ModDetector" then
        ModDetectorContent.Visible = true
        ModDetectorTab.BackgroundColor3 = Color3.fromRGB(70, 110, 220)
        ModDetectorTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        ModDetectorTabStroke.Color = Color3.fromRGB(100, 150, 255)
        ModDetectorTabStroke.Thickness = 2
        ModDetectorTabStroke.Transparency = 0
    elseif tabName == "KnownMods" then
        KnownModsContent.Visible = true
        KnownModsTab.BackgroundColor3 = Color3.fromRGB(70, 110, 220)
        KnownModsTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        KnownModsTabStroke.Color = Color3.fromRGB(100, 150, 255)
        KnownModsTabStroke.Thickness = 2
        KnownModsTabStroke.Transparency = 0
    elseif tabName == "Danger" then
        DangerContent.Visible = true
        DangerTab.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
        DangerTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        DangerTabStroke.Color = Color3.fromRGB(255, 100, 100)
        DangerTabStroke.Thickness = 2
        DangerTabStroke.Transparency = 0
    end
    
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end

GeneralTab.MouseButton1Click:Connect(function() SwitchTab("General") end)
MusicTab.MouseButton1Click:Connect(function() SwitchTab("Music") end)
ModDetectorTab.MouseButton1Click:Connect(function() SwitchTab("ModDetector") end)
KnownModsTab.MouseButton1Click:Connect(function() SwitchTab("KnownMods") end)
DangerTab.MouseButton1Click:Connect(function() SwitchTab("Danger") end)

--// Open/Close Settings Menu
local function ToggleSettings()
    SettingsMenu.Visible = not SettingsMenu.Visible
    if SettingsMenu.Visible then
        SettingsMenu.Size = UDim2.new(0, 0, 0, 0)
        TweenService:Create(SettingsMenu, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 550, 0, 600)
        }):Play()
    end
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end

SettingsButton.MouseButton1Click:Connect(ToggleSettings)
CloseSettingsButton.MouseButton1Click:Connect(ToggleSettings)

--// Make Settings Menu Draggable
local settingsDragging = false
local settingsDragStart, settingsStartPos

SettingsTitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        settingsDragging = true
        settingsDragStart = input.Position
        settingsStartPos = SettingsMenu.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                settingsDragging = false
            end
        end)
    end
end)

SettingsTitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        if settingsDragging then
            local delta = input.Position - settingsDragStart
            SettingsMenu.Position = UDim2.new(
                settingsStartPos.X.Scale,
                settingsStartPos.X.Offset + delta.X,
                settingsStartPos.Y.Scale,
                settingsStartPos.Y.Offset + delta.Y
            )
        end
    end
end)

--// Kill Script Functionality
KillScriptButton.MouseButton1Click:Connect(function()
    ConfirmDialog.Visible = true
    ConfirmDialog.Size = UDim2.new(0, 0, 0, 0)
    TweenService:Create(ConfirmDialog, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 350, 0, 200)
    }):Play()
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

ConfirmYesButton.MouseButton1Click:Connect(function()
    -- Reset the global flag so script can be executed again
    _G.RivalsPlayerInfoLoaded = false
    
    -- Stop music
    if BackgroundMusic then
        BackgroundMusic:Stop()
    end
    
    -- Disconnect the mouse unlock loop to restore normal game controls
    if mouseUnlockConnection then
        mouseUnlockConnection:Disconnect()
    end
    
    -- Play farewell sound
    if Settings.SoundFXEnabled then
        ClickSound.PlaybackSpeed = 0.5
        ClickSound:Play()
        task.wait(0.3)
    end
    
    -- Destroy the entire GUI
    ScreenGui:Destroy()
    
    -- Print goodbye message
    -- UI terminated
end)

ConfirmNoButton.MouseButton1Click:Connect(function()
    TweenService:Create(ConfirmDialog, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 0)
    }):Play()
    task.wait(0.2)
    ConfirmDialog.Visible = false
    if Settings.SoundFXEnabled then
        ClickSound:Play()
    end
end)

--// Hover effects for buttons
CloseSettingsButton.MouseEnter:Connect(function()
    TweenService:Create(CloseSettingsButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(120, 40, 40),
        TextSize = 22
    }):Play()
    TweenService:Create(CloseStroke, TweenInfo.new(0.2), {Transparency = 0}):Play()
end)

CloseSettingsButton.MouseLeave:Connect(function()
    TweenService:Create(CloseSettingsButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(80, 30, 30),
        TextSize = 20
    }):Play()
    TweenService:Create(CloseStroke, TweenInfo.new(0.2), {Transparency = 0.5}):Play()
end)

KillScriptButton.MouseEnter:Connect(function()
    TweenService:Create(KillScriptButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(200, 50, 50),
        TextSize = 20
    }):Play()
end)

KillScriptButton.MouseLeave:Connect(function()
    TweenService:Create(KillScriptButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(150, 40, 40),
        TextSize = 18
    }):Play()
end)

-- Settings button hover effect
SettingsButton.MouseEnter:Connect(function()
    if Settings.SoundFXEnabled then HoverSound:Play() end
    TweenService:Create(SettingsButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundColor3 = Color3.fromRGB(70, 70, 110),
        TextSize = 20,
        Rotation = 90
    }):Play()
    TweenService:Create(SettingsButtonStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 0,
        Color = Color3.fromRGB(150, 150, 255)
    }):Play()
end)

SettingsButton.MouseLeave:Connect(function()
    TweenService:Create(SettingsButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundColor3 = Color3.fromRGB(40, 40, 60),
        TextSize = 18,
        Rotation = 0
    }):Play()
    TweenService:Create(SettingsButtonStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 0.5,
        Color = Color3.fromRGB(100, 100, 150)
    }):Play()
end)

--// UI Toggle with custom keybind
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Settings.ToggleKey then
        isUIVisible = not isUIVisible
        
        if isUIVisible then
            -- Opening UI - Enable and unlock mouse
            ScreenGui.Enabled = true
            
            print("[DEBUG] KEYBIND PRESSED - Opening UI")
            print("[DEBUG] Unlocking mouse - UI is now open")
            
            -- Mouse will be unlocked by the RenderStepped loop
            UserInputService.MouseBehavior = Enum.MouseBehavior.Default
            UserInputService.MouseIconEnabled = true
        else
            -- Closing UI - Disable and let game handle mouse naturally
            ScreenGui.Enabled = false
            SettingsMenu.Visible = false
            
            print("[DEBUG] KEYBIND PRESSED - Closing UI completely")
            print("[DEBUG] UI closed - Script will no longer touch mouse controls")
            
            -- DO NOT touch mouse settings - let the game control it naturally
            -- The RenderStepped loop will automatically stop interfering since ScreenGui.Enabled = false
        end
    end
end)

--// Draggable UI for both TitleBar and MainContainer
local dragging = false
local dragInput, dragStart, startTitlePos, startContainerPos
local isDraggingFromButton = false

local function updateDrag(input)
    if not dragging then return end
    
    local delta = input.Position - dragStart
    
    -- Move both title bar and main container together
    TitleBar.Position = UDim2.new(
        startTitlePos.X.Scale, 
        startTitlePos.X.Offset + delta.X, 
        startTitlePos.Y.Scale, 
        startTitlePos.Y.Offset + delta.Y
    )
    MainContainer.Position = UDim2.new(
        startContainerPos.X.Scale, 
        startContainerPos.X.Offset + delta.X, 
        startContainerPos.Y.Scale, 
        startContainerPos.Y.Offset + delta.Y
    )
end

-- Make TitleBar draggable (but not the button area)
TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        -- Check if we're clicking on the collapse button
        local mousePos = input.Position
        local buttonPos = CollapseButton.AbsolutePosition
        local buttonSize = CollapseButton.AbsoluteSize
        
        if mousePos.X >= buttonPos.X and mousePos.X <= buttonPos.X + buttonSize.X and
           mousePos.Y >= buttonPos.Y and mousePos.Y <= buttonPos.Y + buttonSize.Y then
            -- Clicking on button, don't drag
            return
        end
        
        dragging = true
        dragStart = input.Position
        startTitlePos = TitleBar.Position
        startContainerPos = MainContainer.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateDrag(input)
    end
end)

-- Also make MainContainer draggable (but not the scroll content)
local containerDragging = false
local containerDragStart, containerStartPos

MainContainer.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        -- Check if we're clicking on the scrollbar area or not scrolling
        local relativePos = Vector2.new(input.Position.X, input.Position.Y) - MainContainer.AbsolutePosition
        if relativePos.X > MainContainer.AbsoluteSize.X - 20 then
            -- Clicking scrollbar, don't drag
            return
        end
        
        containerDragging = true
        containerDragStart = Vector2.new(input.Position.X, input.Position.Y)
        containerStartPos = MainContainer.Position
        startTitlePos = TitleBar.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                containerDragging = false
            end
        end)
    end
end)

MainContainer.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        if containerDragging then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - containerDragStart
            
            TitleBar.Position = UDim2.new(
                startTitlePos.X.Scale, 
                startTitlePos.X.Offset + delta.X, 
                startTitlePos.Y.Scale, 
                startTitlePos.Y.Offset + delta.Y
            )
            MainContainer.Position = UDim2.new(
                containerStartPos.X.Scale, 
                containerStartPos.X.Offset + delta.X, 
                containerStartPos.Y.Scale, 
                containerStartPos.Y.Offset + delta.Y
            )
        end
    end
end)

--// Pulsing animation for title
task.spawn(function()
    while task.wait(2) do
        if TitleLabel and TitleLabel.Parent then
            TweenService:Create(TitleLabel, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                TextColor3 = Color3.fromRGB(200, 200, 255)
            }):Play()
            task.wait(1)
            TweenService:Create(TitleLabel, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                TextColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
        else
            break
        end
    end
end)

--// Smooth Fade-In Animation on Load (but still draggable during animation)
task.spawn(function()
    -- Wait a tiny bit for everything to load
    task.wait(0.1)
    
    -- Animate Title Bar sliding down and fading in
    TweenService:Create(TitleBar, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(0, 15, 0, 15),
        BackgroundTransparency = 0
    }):Play()
    
    -- Fade in all child elements of title bar
    for _, child in pairs(TitleBar:GetDescendants()) do
        if child:IsA("TextLabel") or child:IsA("TextButton") then
            child.TextTransparency = 1
            TweenService:Create(child, TweenInfo.new(0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                TextTransparency = 0
            }):Play()
        end
        if child:IsA("UIStroke") then
            local originalTrans = child.Transparency
            child.Transparency = 1
            TweenService:Create(child, TweenInfo.new(0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Transparency = originalTrans
            }):Play()
        end
    end
    
    -- Wait a moment then animate Main Container
    task.wait(0.2)
    
    TweenService:Create(MainContainer, TweenInfo.new(0.7, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(0, 15, 0, 70),
        BackgroundTransparency = 0
    }):Play()
    
    -- Fade in the stroke
    TweenService:Create(MainStroke, TweenInfo.new(0.7, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Transparency = 0.3
    }):Play()
    
    -- Play a subtle whoosh sound
    if Settings.SoundFXEnabled then
        task.wait(0.3)
        ExpandSound.PlaybackSpeed = 0.6
        ExpandSound.Volume = 0.2
        ExpandSound:Play()
        task.wait(0.1)
        ExpandSound.PlaybackSpeed = 0.8
        ExpandSound.Volume = 0.4
    end
end)

-- Custom cursor control - OPTIMIZED with reduced frame checks
local lastMouseCheck = tick()
local mouseUnlockConnection = RunService.RenderStepped:Connect(function()
    -- Only check mouse state every 0.016 seconds (60 FPS optimization)
    if tick() - lastMouseCheck < 0.016 then return end
    lastMouseCheck = tick()
    
    -- ONLY manage cursor if MouseUnlock is enabled
    if Settings.MouseUnlockEnabled then
        -- MouseUnlock is ON: Check if we should show custom cursor
        local shouldShowCustomCursor = SettingsMenu.Visible or (ScreenGui.Enabled and not isCollapsed)
        
        if shouldShowCustomCursor then
            -- Show custom cursor
            if not CustomCursor.Visible then
                UserInputService.MouseBehavior = Enum.MouseBehavior.Default
                UserInputService.MouseIconEnabled = false
                CustomCursor.Visible = true
            end
            
            -- Get mouse position (cached for performance)
            local mouse = LocalPlayer:GetMouse()
            CustomCursor.Position = UDim2.new(0, mouse.X - 23, 0, mouse.Y - 20)
        elseif CustomCursor.Visible then
            -- UI closed/minimized - restore normal cursor
            CustomCursor.Visible = false
            UserInputService.MouseIconEnabled = true
            UserInputService.MouseBehavior = Enum.MouseBehavior.Default
        end
    elseif CustomCursor.Visible then
        -- MouseUnlock is OFF and we were showing custom cursor - restore
        CustomCursor.Visible = false
        UserInputService.MouseIconEnabled = true
        UserInputService.MouseBehavior = Enum.MouseBehavior.Default
    end
end)

print("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
print("‚öîÔ∏è  ROBLOX RIVALS INFO UI - LOADED")
print("üë§ Developer: New_Jmaster")
print("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
